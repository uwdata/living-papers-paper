<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0"/>
    <meta charset="utf-8" />
    <title>The Barnes-Hut Approximation: Efficient computation of N-body forces</title>
    <meta property="og:title" content="The Barnes-Hut Approximation: Efficient computation of N-body forces" />
    <meta property="og:type" content="article" />
    <meta property="og:description" content="The Barnes-Hut Approximation: Efficient computation of N-body forces" />
    <meta property="description" content="The Barnes-Hut Approximation: Efficient computation of N-body forces" />
    <style>
article{--section-prefix:"§";--equation-prefix:"Equation ";--figure-prefix:"Figure ";--table-prefix:"Table ";--double-quote-start:"“";--double-quote-end:"”";--single-quote-start:"‘";--single-quote-end:"’";--highlight-color:#ff0;--tiny-size:0.5em;--script-size:0.7em;--smaller-size:0.8em;--small-size:0.9em;--large-size:1.2em;--larger-size:1.4em;--huge-size:1.8em;--inline-math-size:1em;--ref-color:steelblue;--ref-color-light:#c8dae9;--ref-color-hover:#90b4d2;--ref-color-error:maroon;--ref-weight:500;--ref-decoration:none;width:var(--article-width);margin-left:var(--article-margin-left);padding:var(--article-padding);--inline-math-size:1.14em}a{color:var(--ref-color);font-weight:var(--ref-weight);text-decoration:var(--ref-decoration)}a:hover{color:var(--ref-color-hover)}sub,sup{line-height:0}q{quotes:var(--double-quote-start) var(--double-quote-end)}q.single{quotes:var(--single-quote-start) var(--single-quote-end)}blockquote{margin-left:2em}.action{cursor:pointer;text-decoration:underline dashed 1px #444}.tooltip{display:none;background-color:#fff;z-index:1;position:absolute;filter:drop-shadow(3px 3px 3px rgba(0,0,0,.2));border:1px solid #ccc;padding:.5em;cursor:auto;text-indent:initial;text-align:initial}header h1{font-size:var(--huge-size)}header .author-org{font-style:italic}header .author-org::before{content:" · "}h1{font-size:1.4rem}h2{font-size:1.2rem}h3{font-size:1.1rem}h4,h5,h6{font-size:1rem}h1[data-counter]::before,h2[data-counter]::before,h3[data-counter]::before{content:attr(data-counter) " "}figure.figure>figcaption[data-counter]::before,figure.teaser>figcaption[data-counter]::before{content:var(--figure-prefix) attr(data-counter) ". "}figure.table>figcaption[data-counter]::before{content:var(--table-prefix) attr(data-counter) ". "}table{border-spacing:0;border-collapse:collapse}thead tr{border-bottom:1px solid #ccc}tbody td,thead th{font-size:var(--small-size);padding:1px .33em;text-align:left;font-variant-numeric:tabular-nums}tbody tr{border-bottom:1px solid #eee}ol.references{padding-inline-start:2em}ol.references li{font-size:var(--small-size);margin-bottom:6px}:root{--max-article-width:85ex;--article-padding:32px;--margin-width:400px;--gap-width:100px;--article-width:min(var(--max-article-width), calc(100vw - var(--article-padding) * 2 - var(--gap-width) - var(--margin-width)));--article-margin-left:max(0px, calc(((100vw - var(--article-width) - var(--gap-width) - var(--margin-width)) / 2)))}html{box-sizing:border-box}*,:after,:before{box-sizing:inherit;margin:0;padding:0}h1,h2,h3{padding:0}h1{padding-top:.5em}.title{font-size:24pt;font-weight:700}ol,p,pre,table,ul{margin:0}ol,ul{padding-left:1.5em}section>p{margin-bottom:16px}section>p:last-child{margin-bottom:0}.margin,aside{position:relative;float:right;clear:right;width:var(--margin-width);margin-right:calc(-1 * var(--gap-width) - var(--margin-width));margin-bottom:1em;vertical-align:unset}aside{margin-left:0;margin-top:0}aside>:first-child{margin-top:0}aside>:last-child{margin-bottom:0}.inlinenote-number{line-height:1;padding:1px}.float-left{float:left;margin-right:1em}.float-right{float:right;margin-left:1em}.sticky{position:sticky;top:0;z-index:10}.page{text-align:justify;width:calc(90vw - 2 * var(--article-padding) - 2 * var(--article-margin-left))}figure,pre{max-width:calc(100vw - 2 * var(--article-padding) - 2 * var(--article-margin-left));overflow-x:auto}.full{max-width:100vw}.full-image{width:100%;object-fit:cover;vertical-align:middle}.full figcaption{background:#eee;padding:16px 0}.centered{text-align:center}figure{margin:0;padding:5px 0}aside canvas,aside img,aside svg,figure canvas,figure img,figure svg{object-fit:contain;max-width:100%;height:auto}header{padding-bottom:1em}footer{padding:2em 0}@media (max-width:1100px){:root{--article-padding:16px}article{width:min(var(--max-article-width),calc(100% - var(--article-padding) * 2))}figure,pre{max-width:calc(100vw - var(--article-padding) * 2)}.page{width:min(var(--max-article-width),100%)}.margin,aside{float:none;margin:0;width:auto}.inline-note-number{cursor:pointer;padding:1px 4px}.inline-note .note::before,.inline-note:not(.open) .note{display:none}}@media print{.sticky{position:relative}}.error-block{display:block;border:1px solid red;padding:1em;max-width:800px;font-size:.9em}.quadtree{background-color:#fff;text-align:center;padding-top:20vh}svg.marks path,svg.marks text{transition:opacity .5s}body{font:16px/1.5 -apple-system,system-ui,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";background:#fff;color:#000}:not(pre)>code,pre{font-family:monospace;font-size:15px}h1,h2,h3,h4,h5,h6{font-weight:600;line-height:1.25em;margin:24px 0 16px}h1,h2{border-bottom:1px solid rgba(0,0,0,.1);padding-bottom:6px;width:fit-content}.katex-display,article p,article>code-block>pre,article>ol,article>pre,article>table,article>ul{margin:12px 0}td,th{border-bottom:1px solid rgba(0,0,0,.2);transition:.1s ease-out}th,tr:hover td{background:rgba(0,0,0,.1)}figure>figcaption{font-weight:600;font-size:var(--small-size);line-height:1.4em;padding-bottom:1ex}.sticky{background:rgba(255,255,255,.8);backdrop-filter:blur(4px)}.note,aside{font-style:inherit;font-size:var(--small-size)}.note{background:#fff;transition:.1s ease-out}.inline-note:hover .inline-note-number,.inline-note:hover .note{background:var(--ref-color-light)}.inline-note .note::before{font-size:var(--smaller-size)}.normal{font-weight:400}.demi{font-weight:600}.bold,.strong{font-weight:700}.code,.mono{font-family:monospace}.em,.emph,.italic{font-style:italic}.highlight{background-color:var(--highlight-color)}.strike{text-decoration:line-through}.underline{text-decoration:underline}.smallcaps{font-variant:small-caps}.lowercase{text-transform:lowercase}.uppercase{text-transform:uppercase}.capitalize{text-transform:capitalize}.left{text-align:left}.right{text-align:right}.center{text-align:center}.justify{text-align:justify}.tiny{font-size:var(--tiny-size)}.scriptsize{font-size:var(--script-size)}.footnotesize,.smaller{font-size:var(--smaller-size)}.small{font-size:var(--small-size)}.large{font-size:var(--large-size)}.larger{font-size:var(--larger-size)}.huge{font-size:var(--huge-size)}.hide{display:none}:root{--margin-width:500px}.barnes-hut{margin-top:-20vh}.t00,.t00:hover{color:#3b0f70;text-decoration:underline 1px dashed rgb(59,15,112)}.t00:hover{filter:brightness(1.8)}.t05,.t05:hover{color:#8c2981;text-decoration:underline 1px dashed rgb(140,41,129)}.t05:hover{filter:brightness(1.5)}.t10,.t10:hover{color:#de4968;text-decoration:underline 1px dashed rgb(222,73,104)}.t10:hover{filter:brightness(1.5)}.t15,.t15:hover{color:#fe9f6d;text-decoration:underline 1px dashed rgb(254,159,109)}.t15:hover{filter:brightness(1.2)}
    </style>
  </head>
  <body>
    <article><header><h1 role="banner">The Barnes-Hut Approximation: Efficient computation of N-body forces</h1></header><aside class="margin sticky barnes-hut"><p><barnes-hut data-attr="1" width="500" height="500"></barnes-hut></p></aside><h1 id="introduction" data-counter="1">Introduction</h1><p>Computers are exciting tools for discovery, with which we can model and explore complex phenomena.
For example, to test theories about the formation of the universe, we can perform <em>simulations</em> to predict how galaxies evolve.
We could gather the estimated mass and location of stars and model their gravitational interactions over time.</p><p>Another avenue for discovery is to <em>visualize</em> complex information to reveal structure and patterns.
Consider this network diagram, showing connections between people in a social network. We can examine community groups and identify people who bridge between them.</p><p>Though they may seem quite different at first, these two examples share a common need.
They both require computing forces that arise from pairwise interactions among a set of points, often referred to as an <em>N-body problem</em>.
In the case of astronomical simulation, we seek to model the gravitational forces among stars.
In the case of network visualization, we compute the layout using a similar physical simulation: nodes in the network act as charged particles that repel each other, links act as springs that pull related nodes together.</p><p><em>To get a sense of how this force-directed layout works, drag the nodes or use the slider to adjust the force strength.</em>
Negative values indicate repulsive forces, while positive values indicate attractive forces.</p><cell-view data-bind="charge" data-cell="7"></cell-view><p>A straightforward approach to computing N-body forces is to consider all pairs of individual points and add up the contributions of each interaction.
This naïve scheme has <em>quadratic complexity</em>: as the number of points <em>n</em> increases, the running time grows proportionally to <em>n</em><sup>2</sup>, quickly leading to intractably long calculations.
How might we do better?</p><h1 id="the-barnes-hut-approximation" data-counter="2">The Barnes-Hut Approximation</h1><p>To accelerate computation and make large-scale simulations possible, the astronomers Josh Barnes and Piet Hut devised a clever scheme: approximate long-range forces by replacing a group of distant points with their center of mass.
In exchange for a small amount of error, this scheme significantly speeds up calculation, with complexity <em>n log n</em> rather than <em>n</em><sup>2</sup>.</p><p>Central to this approximation is a <em>spatial index</em>: a <q>map</q> of space that helps us model groups of points as a single center of mass.
In two dimensions, we use a <a href="https://en.wikipedia.org/wiki/Quadtree">quadtree</a> data structure, which subdivides square regions of space into four equal-sized quadrants.
(In three dimensions, an <a href="https://en.wikipedia.org/wiki/Octree">octree</a> divides a cubic volume into eight sub-cubes.)</p><p>The Barnes-Hut approximation involves three steps:</p><ol><li>Construct the spatial index (quadtree)</li><li>Calculate centers of mass</li><li>Estimate forces</li></ol><p>Let’s explore each step in turn.
We will assume we are computing <em>repulsive</em> forces for the purposes of network layout.
This setup is akin to modeling anti-gravity or electric forces with similarly-charged particles.
While we will use the term <q>center of mass</q>, this could readily be replaced with <q>center of charge</q>.</p><p><em>As you read through, click the <a data-attr="2" class="action">action links</a> to update the diagram!</em></p><h2 id="step-1-construct-the-quadtree" data-counter="2.1">Step 1: Construct the Quadtree</h2><p>We begin with <a data-attr="3" class="action">a set of two-dimensional input points</a>.
When we <a data-attr="4" class="action">insert the first point into the quadtree</a>, it is added to the top-level root cell of the tree.</p><p><a data-attr="5" class="action">When we insert another point</a>, the tree expands by subdiving the space.
With
<a data-attr="6" class="action">each</a>
<a data-attr="7" class="action">subsequent</a>
<a data-attr="8" class="action">insertion</a>,
more fine-grained cells are added until all points reside in their own cell.</p><p><em>Advance the slider to add each point and produce the full quadtree</em>.</p><cell-view data-bind="step" data-cell="8"></cell-view><h2 id="step-2-calculate-centers-of-mass" data-counter="2.2">Step 2: Calculate Centers of Mass</h2><p>After quadtree construction, <a data-attr="9" class="action">we calculate centers of mass for each cell of the tree</a>.
The center of mass of a quadtree cell is the weighted average of the centers of its four child cells.</p><p>We visit the leaf node cells first and then visit subsequent parent cells, merging data as we pass upwards through the tree.
Once the traversal completes, each cell has been updated with the position and strength of its center of mass.</p><h2 id="step-3-estimate-n-body-forces" data-counter="2.3">Step 3: Estimate N-Body Forces</h2><p>Now we are ready to estimate forces!</p><p><a data-attr="10" class="action">To measure forces at a given point, let’s add a <q>probe</q> <img alt="Probe icon" src="probe.svg"></img> to our diagram</a>.
The purple line extending from the probe indicates the direction and magnitude of the total force at that location.
(To promote visibility, the purple line is three times longer than the actual pixel distance the probe would be moved in a single timestep of the force simulation.)
The dotted lines extending to the probe represent the force components exerted by individual points.</p><p><em>Move the probe (click or drag) to explore the force field</em>.</p><p>Ignoring the quadtree, we can naïvely calculate forces by summing the contributions of <em>all</em> individual points.
Of course, we want to use the quadtree to accelerate calculation and approximate long-range forces.
Rather than compute interactions among individual points, <a data-attr="11" class="action">we can compute interactions with centers of mass</a>, using smaller quadtree cells for nearer points and larger cells for more distant points.</p><p>At this point we skipped a critical detail: what constitutes <q>long-range</q> versus <q>short-range</q> forces?
We consider both the <em>distance</em> to the center of a quadtree cell and that cell’s <em>width</em>.
If the ratio <em>width / distance</em> falls below a chosen threshold – a parameter Θ (<em>theta</em>) – we treat the quadtree cell as a source of long-range forces and use its center of mass.
Otherwise, we will recursively visit the child cells in the quadtree.</p><p>When Θ = 1, a quadtree cell’s center of mass will be used – and its internal points ignored – if the distance from the sample point to the cell’s center is greater than or equal to the cell’s width.</p><p><em>Adjust the Θ parameter to view its effect on force estimation</em>.</p><p>How does the number of considered points change based on the probe location and Θ?
How does the direction and magnitude of the total force vary with Θ?</p><cell-view data-bind-set="theta" data-cell="9"></cell-view><p>We can now perform force estimation for each individual point, using the Barnes-Hut approximation to limit the total number of comparisons!</p><h1 id="performance-analysis" data-counter="3">Performance Analysis</h1><p>To assess the performance of the Barnes-Hut approximation, we can look at
both the running time and accuracy of force estimation.
We will compare naïve (<em>n</em><sup>2</sup>) calculation to different settings of the Θ parameter.</p><p>We will take measurements using different point sets, ranging from 500 to 10,000 points.
For each point count, we average the results from 50 separate runs of force estimation, each time using a different set of points placed at uniformly random coordinates within a 900 x 500 pixel rectangle.</p><p><time-plot data-bind="focus"></time-plot></p><p>The running time results confirm that the Barnes-Hut approximation can significantly speed-up computation.
As expected, the <a data-attr="12" class="t00 action">naïve approach</a> exhibits a quadratic relationship, whereas increasing the Θ parameter leads to faster calculations.
A low setting of <a data-attr="13" class="t05 action">Θ = 0.5</a> does not fare better than the naïve approach until processing about 6,000 points.
Until that point, the overhead of quadtree construction and center of mass calculation outstrips any gains in force estimation.
In contrast, for <a data-attr="14" class="t10 action">Θ = 1</a> and <a data-attr="15" class="t15 action">Θ = 1.5</a> we see significant improvements in running time.</p><p>To evaluate approximation error, we measure the average vector distance between the results of the naïve scheme and Barnes-Hut.
In the context of a force-directed graph layout, this error represents the difference (in pixels) between node positions after applying the naïve and approximate methods.</p><p><error-plot data-bind="focus"></error-plot></p><p>Looking at the error results, we first see that the average error is relatively small: only ~5% of a single pixel in difference!
However, we should take care interpreting these results, as we use the <em>average</em> error per point and the <em>maximum</em> error may be substantially higher.
While <a data-attr="16" class="t10 action">Θ = 1</a> and <a data-attr="17" class="t15 action">Θ = 1.5</a> exhibit similar <em>running times</em>, here we see notably higher <em>error rates</em> for <a data-attr="18" class="t15 action">Θ = 1.5</a> versus <a data-attr="19" class="t10 action">Θ = 1</a> and <a data-attr="20" class="t05 action">Θ = 0.5</a>.</p><p>These results suggest that a good default value for Θ – with low running time <em>and</em> low approximation error – is around 1.0.
Indeed, in practice it is common to see default settings slightly below 1.
In visualization applications, where errors on the order of a few pixels are not a problem, even higher Θ values may be used without issue.</p><h1 id="conclusion" data-counter="4">Conclusion</h1><p>The Barnes-Hut approximation has had a major impact on both physical simulation and network visualization, enabling n-body calculations to scale to much larger data sets than naïve force calculation permits.</p><p><a data-attr="21" class="action">Returning to our initial network diagram</a>, we can use Barnes-Hut to efficiently compute repulsive forces at each timestep.
For each animation frame, we perform the approximation anew, creating a new quadtree, accumulating centers of mass, and (approximately) estimating forces.</p></article>
    <script type="module">
/**
 * @license
 * Copyright 2019 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
const e=window,t=e.ShadowRoot&&(void 0===e.ShadyCSS||e.ShadyCSS.nativeShadow)&&"adoptedStyleSheets"in Document.prototype&&"replace"in CSSStyleSheet.prototype,n=Symbol(),r=new WeakMap;const i=e=>new class{constructor(e,t,r){if(this._$cssResult$=!0,r!==n)throw Error("CSSResult is not constructable. Use `unsafeCSS` or `css` instead.");this.cssText=e,this.t=t}get styleSheet(){let e=this.o;const n=this.t;if(t&&void 0===e){const t=void 0!==n&&1===n.length;t&&(e=r.get(n)),void 0===e&&((this.o=e=new CSSStyleSheet).replaceSync(this.cssText),t&&r.set(n,e))}return e}toString(){return this.cssText}}("string"==typeof e?e:e+"",void 0,n),s=t?e=>e:e=>e instanceof CSSStyleSheet?(e=>{let t="";for(const n of e.cssRules)t+=n.cssText;return i(t)})(e):e
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */;var o;const a=window,l=a.trustedTypes,c=l?l.emptyScript:"",u=a.reactiveElementPolyfillSupport,d={toAttribute(e,t){switch(t){case Boolean:e=e?c:null;break;case Object:case Array:e=null==e?e:JSON.stringify(e)}return e},fromAttribute(e,t){let n=e;switch(t){case Boolean:n=null!==e;break;case Number:n=null===e?null:Number(e);break;case Object:case Array:try{n=JSON.parse(e)}catch(e){n=null}}return n}},f=(e,t)=>t!==e&&(t==t||e==e),h={attribute:!0,type:String,converter:d,reflect:!1,hasChanged:f};let p=class extends HTMLElement{constructor(){super(),this._$Ei=new Map,this.isUpdatePending=!1,this.hasUpdated=!1,this._$El=null,this.u()}static addInitializer(e){var t;this.finalize(),(null!==(t=this.h)&&void 0!==t?t:this.h=[]).push(e)}static get observedAttributes(){this.finalize();const e=[];return this.elementProperties.forEach(((t,n)=>{const r=this._$Ep(n,t);void 0!==r&&(this._$Ev.set(r,n),e.push(r))})),e}static createProperty(e,t=h){if(t.state&&(t.attribute=!1),this.finalize(),this.elementProperties.set(e,t),!t.noAccessor&&!this.prototype.hasOwnProperty(e)){const n="symbol"==typeof e?Symbol():"__"+e,r=this.getPropertyDescriptor(e,n,t);void 0!==r&&Object.defineProperty(this.prototype,e,r)}}static getPropertyDescriptor(e,t,n){return{get(){return this[t]},set(r){const i=this[e];this[t]=r,this.requestUpdate(e,i,n)},configurable:!0,enumerable:!0}}static getPropertyOptions(e){return this.elementProperties.get(e)||h}static finalize(){if(this.hasOwnProperty("finalized"))return!1;this.finalized=!0;const e=Object.getPrototypeOf(this);if(e.finalize(),void 0!==e.h&&(this.h=[...e.h]),this.elementProperties=new Map(e.elementProperties),this._$Ev=new Map,this.hasOwnProperty("properties")){const e=this.properties,t=[...Object.getOwnPropertyNames(e),...Object.getOwnPropertySymbols(e)];for(const n of t)this.createProperty(n,e[n])}return this.elementStyles=this.finalizeStyles(this.styles),!0}static finalizeStyles(e){const t=[];if(Array.isArray(e)){const n=new Set(e.flat(1/0).reverse());for(const e of n)t.unshift(s(e))}else void 0!==e&&t.push(s(e));return t}static _$Ep(e,t){const n=t.attribute;return!1===n?void 0:"string"==typeof n?n:"string"==typeof e?e.toLowerCase():void 0}u(){var e;this._$E_=new Promise((e=>this.enableUpdating=e)),this._$AL=new Map,this._$Eg(),this.requestUpdate(),null===(e=this.constructor.h)||void 0===e||e.forEach((e=>e(this)))}addController(e){var t,n;(null!==(t=this._$ES)&&void 0!==t?t:this._$ES=[]).push(e),void 0!==this.renderRoot&&this.isConnected&&(null===(n=e.hostConnected)||void 0===n||n.call(e))}removeController(e){var t;null===(t=this._$ES)||void 0===t||t.splice(this._$ES.indexOf(e)>>>0,1)}_$Eg(){this.constructor.elementProperties.forEach(((e,t)=>{this.hasOwnProperty(t)&&(this._$Ei.set(t,this[t]),delete this[t])}))}createRenderRoot(){var n;const r=null!==(n=this.shadowRoot)&&void 0!==n?n:this.attachShadow(this.constructor.shadowRootOptions);return((n,r)=>{t?n.adoptedStyleSheets=r.map((e=>e instanceof CSSStyleSheet?e:e.styleSheet)):r.forEach((t=>{const r=document.createElement("style"),i=e.litNonce;void 0!==i&&r.setAttribute("nonce",i),r.textContent=t.cssText,n.appendChild(r)}))})(r,this.constructor.elementStyles),r}connectedCallback(){var e;void 0===this.renderRoot&&(this.renderRoot=this.createRenderRoot()),this.enableUpdating(!0),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostConnected)||void 0===t?void 0:t.call(e)}))}enableUpdating(e){}disconnectedCallback(){var e;null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostDisconnected)||void 0===t?void 0:t.call(e)}))}attributeChangedCallback(e,t,n){this._$AK(e,n)}_$EO(e,t,n=h){var r;const i=this.constructor._$Ep(e,n);if(void 0!==i&&!0===n.reflect){const s=(void 0!==(null===(r=n.converter)||void 0===r?void 0:r.toAttribute)?n.converter:d).toAttribute(t,n.type);this._$El=e,null==s?this.removeAttribute(i):this.setAttribute(i,s),this._$El=null}}_$AK(e,t){var n;const r=this.constructor,i=r._$Ev.get(e);if(void 0!==i&&this._$El!==i){const e=r.getPropertyOptions(i),s="function"==typeof e.converter?{fromAttribute:e.converter}:void 0!==(null===(n=e.converter)||void 0===n?void 0:n.fromAttribute)?e.converter:d;this._$El=i,this[i]=s.fromAttribute(t,e.type),this._$El=null}}requestUpdate(e,t,n){let r=!0;void 0!==e&&(((n=n||this.constructor.getPropertyOptions(e)).hasChanged||f)(this[e],t)?(this._$AL.has(e)||this._$AL.set(e,t),!0===n.reflect&&this._$El!==e&&(void 0===this._$EC&&(this._$EC=new Map),this._$EC.set(e,n))):r=!1),!this.isUpdatePending&&r&&(this._$E_=this._$Ej())}async _$Ej(){this.isUpdatePending=!0;try{await this._$E_}catch(e){Promise.reject(e)}const e=this.scheduleUpdate();return null!=e&&await e,!this.isUpdatePending}scheduleUpdate(){return this.performUpdate()}performUpdate(){var e;if(!this.isUpdatePending)return;this.hasUpdated,this._$Ei&&(this._$Ei.forEach(((e,t)=>this[t]=e)),this._$Ei=void 0);let t=!1;const n=this._$AL;try{t=this.shouldUpdate(n),t?(this.willUpdate(n),null===(e=this._$ES)||void 0===e||e.forEach((e=>{var t;return null===(t=e.hostUpdate)||void 0===t?void 0:t.call(e)})),this.update(n)):this._$Ek()}catch(e){throw t=!1,this._$Ek(),e}t&&this._$AE(n)}willUpdate(e){}_$AE(e){var t;null===(t=this._$ES)||void 0===t||t.forEach((e=>{var t;return null===(t=e.hostUpdated)||void 0===t?void 0:t.call(e)})),this.hasUpdated||(this.hasUpdated=!0,this.firstUpdated(e)),this.updated(e)}_$Ek(){this._$AL=new Map,this.isUpdatePending=!1}get updateComplete(){return this.getUpdateComplete()}getUpdateComplete(){return this._$E_}shouldUpdate(e){return!0}update(e){void 0!==this._$EC&&(this._$EC.forEach(((e,t)=>this._$EO(t,this[t],e))),this._$EC=void 0),this._$Ek()}updated(e){}firstUpdated(e){}};
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var m;p.finalized=!0,p.elementProperties=new Map,p.elementStyles=[],p.shadowRootOptions={mode:"open"},null==u||u({ReactiveElement:p}),(null!==(o=a.reactiveElementVersions)&&void 0!==o?o:a.reactiveElementVersions=[]).push("1.6.1");const v=window,y=v.trustedTypes,b=y?y.createPolicy("lit-html",{createHTML:e=>e}):void 0,w="$lit$",_=`lit$${(Math.random()+"").slice(9)}$`,g="?"+_,E=`<${g}>`,A=document,$=()=>A.createComment(""),x=e=>null===e||"object"!=typeof e&&"function"!=typeof e,S=Array.isArray,N="[ \t\n\f\r]",k=/<(?:(!--|\/[^a-zA-Z])|(\/?[a-zA-Z][^>\s]*)|(\/?$))/g,T=/-->/g,j=/>/g,C=RegExp(`>|${N}(?:([^\\s"'>=/]+)(${N}*=${N}*(?:[^ \t\n\f\r"'\`<>=]|("|')|))|$)`,"g"),O=/'/g,P=/"/g,M=/^(?:script|style|textarea|title)$/i,R=(e=>(t,...n)=>({_$litType$:e,strings:t,values:n}))(1),L=Symbol.for("lit-noChange"),q=Symbol.for("lit-nothing"),I=new WeakMap,U=A.createTreeWalker(A,129,null,!1),D=(e,t)=>{const n=e.length-1,r=[];let i,s=2===t?"<svg>":"",o=k;for(let t=0;t<n;t++){const n=e[t];let a,l,c=-1,u=0;for(;u<n.length&&(o.lastIndex=u,l=o.exec(n),null!==l);)u=o.lastIndex,o===k?"!--"===l[1]?o=T:void 0!==l[1]?o=j:void 0!==l[2]?(M.test(l[2])&&(i=RegExp("</"+l[2],"g")),o=C):void 0!==l[3]&&(o=C):o===C?">"===l[0]?(o=null!=i?i:k,c=-1):void 0===l[1]?c=-2:(c=o.lastIndex-l[2].length,a=l[1],o=void 0===l[3]?C:'"'===l[3]?P:O):o===P||o===O?o=C:o===T||o===j?o=k:(o=C,i=void 0);const d=o===C&&e[t+1].startsWith("/>")?" ":"";s+=o===k?n+E:c>=0?(r.push(a),n.slice(0,c)+w+n.slice(c)+_+d):n+_+(-2===c?(r.push(void 0),t):d)}const a=s+(e[n]||"<?>")+(2===t?"</svg>":"");if(!Array.isArray(e)||!e.hasOwnProperty("raw"))throw Error("invalid template strings array");return[void 0!==b?b.createHTML(a):a,r]};class B{constructor({strings:e,_$litType$:t},n){let r;this.parts=[];let i=0,s=0;const o=e.length-1,a=this.parts,[l,c]=D(e,t);if(this.el=B.createElement(l,n),U.currentNode=this.el.content,2===t){const e=this.el.content,t=e.firstChild;t.remove(),e.append(...t.childNodes)}for(;null!==(r=U.nextNode())&&a.length<o;){if(1===r.nodeType){if(r.hasAttributes()){const e=[];for(const t of r.getAttributeNames())if(t.endsWith(w)||t.startsWith(_)){const n=c[s++];if(e.push(t),void 0!==n){const e=r.getAttribute(n.toLowerCase()+w).split(_),t=/([.?@])?(.*)/.exec(n);a.push({type:1,index:i,name:t[2],strings:e,ctor:"."===t[1]?V:"?"===t[1]?Y:"@"===t[1]?Z:W})}else a.push({type:6,index:i})}for(const t of e)r.removeAttribute(t)}if(M.test(r.tagName)){const e=r.textContent.split(_),t=e.length-1;if(t>0){r.textContent=y?y.emptyScript:"";for(let n=0;n<t;n++)r.append(e[n],$()),U.nextNode(),a.push({type:2,index:++i});r.append(e[t],$())}}}else if(8===r.nodeType)if(r.data===g)a.push({type:2,index:i});else{let e=-1;for(;-1!==(e=r.data.indexOf(_,e+1));)a.push({type:7,index:i}),e+=_.length-1}i++}}static createElement(e,t){const n=A.createElement("template");return n.innerHTML=e,n}}function H(e,t,n=e,r){var i,s,o,a;if(t===L)return t;let l=void 0!==r?null===(i=n._$Co)||void 0===i?void 0:i[r]:n._$Cl;const c=x(t)?void 0:t._$litDirective$;return(null==l?void 0:l.constructor)!==c&&(null===(s=null==l?void 0:l._$AO)||void 0===s||s.call(l,!1),void 0===c?l=void 0:(l=new c(e),l._$AT(e,n,r)),void 0!==r?(null!==(o=(a=n)._$Co)&&void 0!==o?o:a._$Co=[])[r]=l:n._$Cl=l),void 0!==l&&(t=H(e,l._$AS(e,t.values),l,r)),t}class F{constructor(e,t){this.u=[],this._$AN=void 0,this._$AD=e,this._$AM=t}get parentNode(){return this._$AM.parentNode}get _$AU(){return this._$AM._$AU}v(e){var t;const{el:{content:n},parts:r}=this._$AD,i=(null!==(t=null==e?void 0:e.creationScope)&&void 0!==t?t:A).importNode(n,!0);U.currentNode=i;let s=U.nextNode(),o=0,a=0,l=r[0];for(;void 0!==l;){if(o===l.index){let t;2===l.type?t=new z(s,s.nextSibling,this,e):1===l.type?t=new l.ctor(s,l.name,l.strings,this,e):6===l.type&&(t=new J(s,this,e)),this.u.push(t),l=r[++a]}o!==(null==l?void 0:l.index)&&(s=U.nextNode(),o++)}return i}p(e){let t=0;for(const n of this.u)void 0!==n&&(void 0!==n.strings?(n._$AI(e,n,t),t+=n.strings.length-2):n._$AI(e[t])),t++}}class z{constructor(e,t,n,r){var i;this.type=2,this._$AH=q,this._$AN=void 0,this._$AA=e,this._$AB=t,this._$AM=n,this.options=r,this._$Cm=null===(i=null==r?void 0:r.isConnected)||void 0===i||i}get _$AU(){var e,t;return null!==(t=null===(e=this._$AM)||void 0===e?void 0:e._$AU)&&void 0!==t?t:this._$Cm}get parentNode(){let e=this._$AA.parentNode;const t=this._$AM;return void 0!==t&&11===(null==e?void 0:e.nodeType)&&(e=t.parentNode),e}get startNode(){return this._$AA}get endNode(){return this._$AB}_$AI(e,t=this){e=H(this,e,t),x(e)?e===q||null==e||""===e?(this._$AH!==q&&this._$AR(),this._$AH=q):e!==this._$AH&&e!==L&&this.g(e):void 0!==e._$litType$?this.$(e):void 0!==e.nodeType?this.T(e):(e=>S(e)||"function"==typeof(null==e?void 0:e[Symbol.iterator]))(e)?this.k(e):this.g(e)}S(e){return this._$AA.parentNode.insertBefore(e,this._$AB)}T(e){this._$AH!==e&&(this._$AR(),this._$AH=this.S(e))}g(e){this._$AH!==q&&x(this._$AH)?this._$AA.nextSibling.data=e:this.T(A.createTextNode(e)),this._$AH=e}$(e){var t;const{values:n,_$litType$:r}=e,i="number"==typeof r?this._$AC(e):(void 0===r.el&&(r.el=B.createElement(r.h,this.options)),r);if((null===(t=this._$AH)||void 0===t?void 0:t._$AD)===i)this._$AH.p(n);else{const e=new F(i,this),t=e.v(this.options);e.p(n),this.T(t),this._$AH=e}}_$AC(e){let t=I.get(e.strings);return void 0===t&&I.set(e.strings,t=new B(e)),t}k(e){S(this._$AH)||(this._$AH=[],this._$AR());const t=this._$AH;let n,r=0;for(const i of e)r===t.length?t.push(n=new z(this.S($()),this.S($()),this,this.options)):n=t[r],n._$AI(i),r++;r<t.length&&(this._$AR(n&&n._$AB.nextSibling,r),t.length=r)}_$AR(e=this._$AA.nextSibling,t){var n;for(null===(n=this._$AP)||void 0===n||n.call(this,!1,!0,t);e&&e!==this._$AB;){const t=e.nextSibling;e.remove(),e=t}}setConnected(e){var t;void 0===this._$AM&&(this._$Cm=e,null===(t=this._$AP)||void 0===t||t.call(this,e))}}class W{constructor(e,t,n,r,i){this.type=1,this._$AH=q,this._$AN=void 0,this.element=e,this.name=t,this._$AM=r,this.options=i,n.length>2||""!==n[0]||""!==n[1]?(this._$AH=Array(n.length-1).fill(new String),this.strings=n):this._$AH=q}get tagName(){return this.element.tagName}get _$AU(){return this._$AM._$AU}_$AI(e,t=this,n,r){const i=this.strings;let s=!1;if(void 0===i)e=H(this,e,t,0),s=!x(e)||e!==this._$AH&&e!==L,s&&(this._$AH=e);else{const r=e;let o,a;for(e=i[0],o=0;o<i.length-1;o++)a=H(this,r[n+o],t,o),a===L&&(a=this._$AH[o]),s||(s=!x(a)||a!==this._$AH[o]),a===q?e=q:e!==q&&(e+=(null!=a?a:"")+i[o+1]),this._$AH[o]=a}s&&!r&&this.j(e)}j(e){e===q?this.element.removeAttribute(this.name):this.element.setAttribute(this.name,null!=e?e:"")}}class V extends W{constructor(){super(...arguments),this.type=3}j(e){this.element[this.name]=e===q?void 0:e}}const G=y?y.emptyScript:"";class Y extends W{constructor(){super(...arguments),this.type=4}j(e){e&&e!==q?this.element.setAttribute(this.name,G):this.element.removeAttribute(this.name)}}class Z extends W{constructor(e,t,n,r,i){super(e,t,n,r,i),this.type=5}_$AI(e,t=this){var n;if((e=null!==(n=H(this,e,t,0))&&void 0!==n?n:q)===L)return;const r=this._$AH,i=e===q&&r!==q||e.capture!==r.capture||e.once!==r.once||e.passive!==r.passive,s=e!==q&&(r===q||i);i&&this.element.removeEventListener(this.name,this,r),s&&this.element.addEventListener(this.name,this,e),this._$AH=e}handleEvent(e){var t,n;"function"==typeof this._$AH?this._$AH.call(null!==(n=null===(t=this.options)||void 0===t?void 0:t.host)&&void 0!==n?n:this.element,e):this._$AH.handleEvent(e)}}class J{constructor(e,t,n){this.element=e,this.type=6,this._$AN=void 0,this._$AM=t,this.options=n}get _$AU(){return this._$AM._$AU}_$AI(e){H(this,e)}}const K=v.litHtmlPolyfillSupport;null==K||K(B,z),(null!==(m=v.litHtmlVersions)&&void 0!==m?m:v.litHtmlVersions=[]).push("2.7.0");
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */
var X,Q;class ee extends p{constructor(){super(...arguments),this.renderOptions={host:this},this._$Do=void 0}createRenderRoot(){var e,t;const n=super.createRenderRoot();return null!==(e=(t=this.renderOptions).renderBefore)&&void 0!==e||(t.renderBefore=n.firstChild),n}update(e){const t=this.render();this.hasUpdated||(this.renderOptions.isConnected=this.isConnected),super.update(e),this._$Do=((e,t,n)=>{var r,i;const s=null!==(r=null==n?void 0:n.renderBefore)&&void 0!==r?r:t;let o=s._$litPart$;if(void 0===o){const e=null!==(i=null==n?void 0:n.renderBefore)&&void 0!==i?i:null;s._$litPart$=o=new z(t.insertBefore($(),e),e,void 0,null!=n?n:{})}return o._$AI(e),o})(t,this.renderRoot,this.renderOptions)}connectedCallback(){var e;super.connectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!0)}disconnectedCallback(){var e;super.disconnectedCallback(),null===(e=this._$Do)||void 0===e||e.setConnected(!1)}render(){return L}}ee.finalized=!0,ee._$litElement$=!0,null===(X=globalThis.litElementHydrateSupport)||void 0===X||X.call(globalThis,{LitElement:ee});const te=globalThis.litElementPolyfillSupport;null==te||te({LitElement:ee}),(null!==(Q=globalThis.litElementVersions)&&void 0!==Q?Q:globalThis.litElementVersions=[]).push("3.3.0");const ne="cell-view",re="data-attr",ie="data-cell",se="data-bind",oe="data-bind-set";class ae{constructor(e,t,n){this.runtime=e,this.name=t,this.value=n,this.paused=!1,this.ignore=null,this.queued=[],this.inputs=new Map,e.variable(null,(e=>e),[t],{fulfilled:e=>this.paused?this.dequeue():this.update(e)})}add(e,{override:t=!1,event:n=ce(e),valueof:r=le}={}){t?this.update(r(e)):r(e,this.value);const i=()=>this.queue(e,r(e));return this.inputs.set(e,{input:e,event:n,listener:i,valueof:r}),e.addEventListener(n,i),this}addCell(e,t){let n;return e.addEventListener("change",(async()=>{const r=e.value;r!==n&&(n&&this.delete(n),this.add(n=r,t))})),this}delete(e){const{event:t,listener:n}=this.inputs.get(e);e.removeEventListener(t,n),this.inputs.delete(e)}queue(e,t){this.ignore!==e&&(this.paused||this.queued.length||function(e){"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,0)}((()=>this.dequeue())),this.queued.push(t))}dequeue(){if(this.paused=!1,this.queued.length){const e=this.queued;this.queued=[],this.update(e.pop())}}update(e){if(this.value!==e){this.value=e,this.paused=!0;for(const{input:t,event:n,valueof:r}of this.inputs.values())r(t)!==e&&(this.ignore=t,r(t,e),t.dispatchEvent(new Event(n)),this.ignore=null);this.runtime.redefine(this.name,e)}}}function le(e,t){if(arguments.length>1)switch(e.type){case"date":return e.valueAsDate=t;case"checkbox":return e.checked=t;default:return e.value=t}else switch(e.type){case"range":case"number":return e.valueAsNumber;case"date":return e.valueAsDate;case"checkbox":return e.checked;default:return e.value}}function ce(e){switch(e.type){case"button":case"submit":case"checkbox":return"click";default:return"input"}}const ue="pending",de="fulfilled",fe="rejected";class he{constructor(e){this.status=ue,this.value=void 0,this.callback=e}promise(){switch(this.status){case de:return Promise.resolve(this.value);case fe:return Promise.reject(this.value.error);case ue:return this._promise||(this._promise=new Promise(((e,t)=>{this._resolve=e,this._reject=t})))}}update(e,t){this.status=e,e!==ue&&(this.value=t),this.callback(this.status,this.value)}pending(){this.update(ue,void 0)}fulfilled(e){this.update(de,e),this._promise&&(this._resolve(e),this._promise=this._resolve=this._reject=null)}rejected(e,t){this.update(fe,{error:e,name:t}),this._promise&&(this._reject(e),this._promise=this._resolve=this._reject=null)}}function pe(e,t,n,r={}){const{cells:i=(()=>[]),attrs:s=(()=>[]),event:o=(()=>[])}=n,a=function(e){const t=new Map;return e.querySelectorAll(`[${re}]`).forEach((e=>{t.set(e.getAttribute(re),e)})),e=>"object"==typeof e?e:t.get(e)}(t);e.define(i(),function(e){const t=new Map;return e.querySelectorAll(ne).forEach((e=>{t.set(+e.getAttribute(ie),e.observer)})),e=>t.get(e.cell)}(t)),e.define(s(),function(e,t){return n=>{const[r,i]=t[n.cell],s=e(r),o=new he(((e,t)=>{e===de?s.setAttribute(i,t):e===fe&&console.error(t.error)}));return s.observers=s.observers||new Map,s.observers.set(i,o),o}}(a,r.attrs)),e.define(o(),function(e,t,n){return r=>{const{define:[i],cell:s}=r,[o,a]=t[s];return e(o).addEventListener(a,n.handler(i)),{rejected(e){console.error(e)}}}}(a,r.events,e)),function(e,t){const n=new Map,r=(t,r)=>{e.querySelectorAll(`[${t}]`).forEach((e=>{const i=e.getAttribute(t),s={el:e,override:r};n.has(i)?n.get(i).push(s):n.set(i,[s])}))};r(se,!1),r(oe,!0);const i=(e,{el:t,override:n})=>{t.tagName.toLowerCase()===ne?e.addCell(t,{override:n}):e.add(t,{override:n})};n.forEach(((e,n)=>{(async function(e,t){return new ae(e,t,await e.value(t))})(t,n).then((t=>{e.forEach((e=>i(t,e)))}))}))}(t,e)}const{getPrototypeOf:me,getOwnPropertyDescriptors:ve}=Object;me({});var ye={},be={};function we(e){return new Function("d","return {"+e.map((function(e,t){return JSON.stringify(e)+": d["+t+'] || ""'})).join(",")+"}")}function _e(e){var t=Object.create(null),n=[];return e.forEach((function(e){for(var r in e)r in t||n.push(t[r]=r)})),n}function ge(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Ee(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),i=e.getUTCSeconds(),s=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+ge(-t,6):t>9999?"+"+ge(t,6):ge(t,4))+"-"+ge(e.getUTCMonth()+1,2)+"-"+ge(e.getUTCDate(),2)+(s?"T"+ge(n,2)+":"+ge(r,2)+":"+ge(i,2)+"."+ge(s,3)+"Z":i?"T"+ge(n,2)+":"+ge(r,2)+":"+ge(i,2)+"Z":r||n?"T"+ge(n,2)+":"+ge(r,2)+"Z":"")}function Ae(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,i=[],s=e.length,o=0,a=0,l=s<=0,c=!1;function u(){if(l)return be;if(c)return c=!1,ye;var t,r,i=o;if(34===e.charCodeAt(i)){for(;o++<s&&34!==e.charCodeAt(o)||34===e.charCodeAt(++o););return(t=o)>=s?l=!0:10===(r=e.charCodeAt(o++))?c=!0:13===r&&(c=!0,10===e.charCodeAt(o)&&++o),e.slice(i+1,t-1).replace(/""/g,'"')}for(;o<s;){if(10===(r=e.charCodeAt(t=o++)))c=!0;else if(13===r)c=!0,10===e.charCodeAt(o)&&++o;else if(r!==n)continue;return e.slice(i,t)}return l=!0,e.slice(i,s)}for(10===e.charCodeAt(s-1)&&--s,13===e.charCodeAt(s-1)&&--s;(r=u())!==be;){for(var d=[];r!==ye&&r!==be;)d.push(r),r=u();t&&null==(d=t(d,a++))||i.push(d)}return i}function i(t,n){return t.map((function(t){return n.map((function(e){return o(t[e])})).join(e)}))}function s(t){return t.map(o).join(e)}function o(e){return null==e?"":e instanceof Date?Ee(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,i,s=r(e,(function(e,r){if(n)return n(e,r-1);i=e,n=t?function(e,t){var n=we(e);return function(r,i){return t(n(r),i,e)}}(e,t):we(e)}));return s.columns=i||[],s},parseRows:r,format:function(t,n){return null==n&&(n=_e(t)),[n.map(o).join(e)].concat(i(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=_e(e)),i(e,t).join("\n")},formatRows:function(e){return e.map(s).join("\n")},formatRow:s,formatValue:o}}var $e=Ae(","),xe=$e.parse,Se=$e.parseRows,Ne=Ae("\t"),ke=Ne.parse,Te=Ne.parseRows;function je(e){for(var t in e){var n,r,i=e[t].trim();if(i)if("true"===i)i=!0;else if("false"===i)i=!1;else if("NaN"===i)i=NaN;else if(isNaN(n=+i)){if(!(r=i.match(/^([-+]\d{2})?\d{4}(-\d{2}(-\d{2})?)?(T\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/)))continue;Ce&&r[4]&&!r[7]&&(i=i.replace(/-/g,"/").replace(/T/," ")),i=new Date(i)}else i=n;else i=null;e[t]=i}return e}const Ce=new Date("2019-01-01T00:00").getHours()||new Date("2019-07-01T00:00").getHours();function Oe(e,t,n){return{resolve:(r=n)=>`${e}@${t}/${r}`}}const Pe=Oe("d3","7.8.4","dist/d3.min.js"),Me=Oe("@observablehq/inputs","0.10.4","dist/inputs.min.js"),Re=Oe("@observablehq/plot","0.6.5","dist/plot.umd.min.js"),Le=Oe("@observablehq/graphviz","0.2.1","dist/graphviz.min.js"),qe=Oe("@observablehq/highlight.js","2.0.0","highlight.min.js"),Ie=Oe("@observablehq/katex","0.11.1","dist/katex.min.js"),Ue=Oe("lodash","4.17.21","lodash.min.js"),De=Oe("htl","0.3.1","dist/htl.min.js"),Be=Oe("jszip","3.10.1","dist/jszip.min.js"),He=Oe("marked","0.3.12","marked.min.js"),Fe=Oe("sql.js","1.8.0","dist/sql-wasm.js"),ze=Oe("vega","5.22.1","build/vega.min.js"),We=Oe("vega-lite","5.6.0","build/vega-lite.min.js"),Ve=Oe("vega-lite-api","5.0.0","build/vega-lite-api.min.js"),Ge=Oe("apache-arrow","4.0.1","Arrow.es2015.min.js"),Ye=Oe("apache-arrow","9.0.0","+esm"),Ze=Oe("apache-arrow","11.0.0","+esm"),Je=Oe("arquero","4.8.8","dist/arquero.min.js"),Ke=Oe("topojson-client","3.1.0","dist/topojson-client.min.js"),Xe=Oe("exceljs","4.3.0","dist/exceljs.min.js"),Qe=Oe("mermaid","9.2.2","dist/mermaid.min.js"),et=Oe("leaflet","1.9.3","dist/leaflet.js"),tt=Oe("@duckdb/duckdb-wasm","1.24.0","+esm"),nt=new Map,rt=[],it=rt.map,st=rt.some,ot=rt.hasOwnProperty,at=/^((?:@[^/@]+\/)?[^/@]+)(?:@([^/]+))?(?:\/(.*))?$/,lt=/^\d+\.\d+\.\d+(-[\w-.+]+)?$/,ct=/(?:\.[^/]*|\/)$/;class ut extends Error{constructor(e){super(e)}}function dt(e){const t=at.exec(e);return t&&{name:t[1],version:t[2],path:t[3]}}function ft(e="https://cdn.jsdelivr.net/npm/",t=["unpkg","jsdelivr","browser","main"]){if(!/\/$/.test(e))throw new Error("origin lacks trailing slash");function n(t){const n=`${e}${t.name}${t.version?`@${t.version}`:""}/package.json`;let r=nt.get(n);return r||nt.set(n,r=fetch(n).then((e=>{if(!e.ok)throw new ut("unable to load package.json");return e.redirected&&!nt.has(e.url)&&nt.set(e.url,r),e.json()}))),r}return async function(r,i){if(r.startsWith(e)&&(r=r.substring(e.length)),/^(\w+:)|\/\//i.test(r))return r;if(/^[.]{0,2}\//i.test(r))return new URL(r,i??location).href;if(!r.length||/^[\s._]/.test(r)||/\s$/.test(r))throw new ut("illegal name");const s=dt(r);if(!s)return`${e}${r}`;if(!s.version&&null!=i&&i.startsWith(e)){const t=await n(dt(i.substring(e.length)));s.version=t.dependencies&&t.dependencies[s.name]||t.peerDependencies&&t.peerDependencies[s.name]}if(s.path&&!ct.test(s.path)&&(s.path+=".js"),s.path&&s.version&&lt.test(s.version))return`${e}${s.name}@${s.version}/${s.path}`;const o=await n(s);return`${e}${o.name}@${o.version}/${s.path||function(e){for(const n of t){let t=e[n];if("string"==typeof t)return t.startsWith("./")&&(t=t.slice(2)),ct.test(t)?t:`${t}.js`}}(o)||"index.js"}`}}ut.prototype.name=ut.name;var ht=pt(ft());function pt(e){const t=new Map,n=i(null);function r(e){if("string"!=typeof e)return e;let n=t.get(e);return n||t.set(e,n=new Promise(((t,n)=>{const r=document.createElement("script");r.onload=()=>{try{t(rt.pop()(i(e)))}catch(e){n(new ut("invalid module"))}r.remove()},r.onerror=()=>{n(new ut("unable to load module")),r.remove()},r.async=!0,r.src=e,window.define=bt,document.head.appendChild(r)}))),n}function i(t){return n=>Promise.resolve(e(n,t)).then(r)}function s(e){return arguments.length>1?Promise.all(it.call(arguments,n)).then(mt):n(e)}return s.alias=function(t){return pt(((n,r)=>n in t&&(r=null,"string"!=typeof(n=t[n]))?n:e(n,r)))},s.resolve=e,s}function mt(e){const t={};for(const n of e)for(const e in n)ot.call(n,e)&&(null==n[e]?Object.defineProperty(t,e,{get:vt(n,e)}):t[e]=n[e]);return t}function vt(e,t){return()=>e[t]}function yt(e){return"exports"===(e+="")||"module"===e}function bt(e,t,n){const r=arguments.length;r<2?(n=e,t=[]):r<3&&(n=t,t="string"==typeof e?[]:e),rt.push(st.call(t,yt)?e=>{const r={},i={exports:r};return Promise.all(it.call(t,(t=>"exports"===(t+="")?r:"module"===t?i:e(t)))).then((e=>(n.apply(null,e),i.exports)))}:e=>Promise.all(it.call(t,e)).then((e=>"function"==typeof n?n.apply(null,e):n)))}bt.amd={};const wt="https://cdn.observableusercontent.com/npm/";let _t,gt=ht;async function Et(e){const[t,n]=await Promise.all([e(Fe.resolve()),e.resolve(Fe.resolve("dist/"))]);return t({locateFile:e=>`${n}${e}`})}class At{constructor(e){Object.defineProperties(this,{_db:{value:e}})}static async open(e){const[t,n]=await Promise.all([Et(gt),Promise.resolve(e).then(xt)]);return new At(new t.Database(n))}async query(e,t){return await async function(e,t,n){const[r]=await e.exec(t,n);if(!r)return[];const{columns:i,values:s}=r,o=s.map((e=>Object.fromEntries(e.map(((e,t)=>[i[t],e])))));return o.columns=i,o}(this._db,e,t)}async queryRow(e,t){return(await this.query(e,t))[0]||null}async explain(e,t){return St("pre",{className:"observablehq--inspect"},[Nt((await this.query(`EXPLAIN QUERY PLAN ${e}`,t)).map((e=>e.detail)).join("\n"))])}async describeTables({schema:e}={}){return this.query(`SELECT NULLIF(schema, 'main') AS schema, name FROM pragma_table_list() WHERE type = 'table'${null==e?"":" AND schema = ?"} AND name NOT LIKE 'sqlite_%' ORDER BY schema, name`,null==e?[]:[e])}async describeColumns({schema:e,table:t}={}){if(null==t)throw new Error("missing table");const n=await this.query(`SELECT name, type, "notnull" FROM pragma_table_info(?${null==e?"":", ?"}) ORDER BY cid`,null==e?[t]:[t,e]);if(!n.length)throw new Error(`table not found: ${t}`);return n.map((({name:e,type:t,notnull:n})=>({name:e,type:$t(t),databaseType:t,nullable:!n})))}async describe(e){const t=await(void 0===e?this.query("SELECT name FROM sqlite_master WHERE type = 'table'"):this.query("SELECT * FROM pragma_table_info(?)",[e]));if(!t.length)throw new Error("Not found");const{columns:n}=t;return St("table",{value:t},[St("thead",[St("tr",n.map((e=>St("th",[Nt(e)]))))]),St("tbody",t.map((e=>St("tr",n.map((t=>St("td",[Nt(e[t])])))))))])}async sql(){return this.query(...this.queryTag.apply(this,arguments))}queryTag(e,...t){return[e.join("?"),t]}}function $t(e){switch(e){case"NULL":return"null";case"INT":case"INTEGER":case"TINYINT":case"SMALLINT":case"MEDIUMINT":case"BIGINT":case"UNSIGNED BIG INT":case"INT2":case"INT8":return"integer";case"TEXT":case"CLOB":case"DATE":case"DATETIME":return"string";case"REAL":case"DOUBLE":case"DOUBLE PRECISION":case"FLOAT":case"NUMERIC":return"number";case"BLOB":return"buffer";default:return/^(?:(?:(?:VARYING|NATIVE) )?CHARACTER|(?:N|VAR|NVAR)CHAR)\(/.test(e)?"string":/^(?:DECIMAL|NUMERIC)\(/.test(e)?"number":"other"}}function xt(e){return"string"==typeof e?fetch(e).then(xt):e instanceof Response||e instanceof Blob?e.arrayBuffer().then(xt):e instanceof ArrayBuffer?new Uint8Array(e):e}function St(e,t,n){2===arguments.length&&(n=t,t=void 0);const r=document.createElement(e);if(void 0!==t)for(const e in t)r[e]=t[e];if(void 0!==n)for(const e of n)r.appendChild(e);return r}function Nt(e){return document.createTextNode(e)}function kt(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Tt(e,t=kt){let n,r=!1;if(1===t.length){let i;for(const s of e){const e=t(s);(r?kt(e,i)>0:0===kt(e,e))&&(n=s,i=e,r=!0)}}else for(const i of e)(r?t(i,n)>0:0===t(i,i))&&(n=i,r=!0);return n}function jt(e){return e&&"function"==typeof e.toArrowBuffer}function Ct(e){return e&&"function"==typeof e.getChild&&"function"==typeof e.toArray&&e.schema&&Array.isArray(e.schema.fields)}function Ot(e){return{name:e.name,type:Pt(e.type),nullable:e.nullable,databaseType:String(e.type)}}function Pt(e){switch(e.typeId){case 2:return"integer";case 3:case 7:return"number";case 4:case 15:return"buffer";case 5:return"string";case 6:return"boolean";case 8:case 9:case 10:return"date";case 12:case 16:return"array";case 13:case 14:return"object";default:return"other"}}async function Mt(){return await import(`${wt}${Ze.resolve()}`)}Object.defineProperty(At.prototype,"dialect",{value:"sqlite"});class Rt{constructor(e){Object.defineProperties(this,{_db:{value:e}})}async queryStream(e,t){const n=await this._db.connect();let r,i;try{if(t?.length>0){const i=await n.prepare(e);r=await i.send(...t)}else r=await n.send(e);if(i=await r.next(),i.done)throw new Error("missing first batch")}catch(e){throw await n.close(),e}return{schema:(s=i.value,s.schema.fields.map(Ot)),async*readRows(){try{for(;!i.done;)yield i.value.toArray(),i=await r.next()}finally{await n.close()}}};var s}async query(e,t){const n=await this.queryStream(e,t),r=[];for await(const e of n.readRows())for(const t of e)r.push(t);return r.schema=n.schema,r}async queryRow(e,t){const n=(await this.queryStream(e,t)).readRows();try{const{done:e,value:t}=await n.next();return e||!t.length?null:t[0]}finally{await n.return()}}async sql(e,...t){return await this.query(e.join("?"),t)}queryTag(e,...t){return[e.join("?"),t]}escape(e){return`"${e}"`}async describeTables(){return(await this.query("SHOW TABLES")).map((({name:e})=>({name:e})))}async describeColumns({table:e}={}){return(await this.query(`DESCRIBE ${this.escape(e)}`)).map((({column_name:e,column_type:t,null:n})=>({name:e,type:Ut(t),nullable:"NO"!==n,databaseType:t})))}static async of(e={},t={}){const n=await async function(){void 0===_t&&(_t=async function(){const e=await import(`${wt}${tt.resolve()}`),t=await e.selectBundle({mvp:{mainModule:`${wt}${tt.resolve("dist/duckdb-mvp.wasm")}`,mainWorker:`${wt}${tt.resolve("dist/duckdb-browser-mvp.worker.js")}`},eh:{mainModule:`${wt}${tt.resolve("dist/duckdb-eh.wasm")}`,mainWorker:`${wt}${tt.resolve("dist/duckdb-browser-eh.worker.js")}`}}),n=new e.ConsoleLogger;return{module:e,bundle:t,logger:n}}());const{module:e,bundle:t,logger:n}=await _t,r=await e.createWorker(t.mainWorker),i=new e.AsyncDuckDB(n,r);return await i.instantiate(t.mainModule),i}();return void 0===t.query?.castTimestampToDate&&(t={...t,query:{...t.query,castTimestampToDate:!0}}),void 0===t.query?.castBigIntToDouble&&(t={...t,query:{...t.query,castBigIntToDouble:!0}}),await n.open(t),await Promise.all(Object.entries(e).map((async([e,t])=>{if(t instanceof Mn)await Lt(n,e,t);else if(Ct(t))await qt(n,e,t);else if(Array.isArray(t))await It(n,e,t);else if(jt(t))await async function(e,t,n){const r=(await Mt()).tableFromIPC(n.toArrowBuffer());return await qt(e,t,r)}(n,e,t);else if("data"in t){const{data:r,...i}=t;Ct(r)?await qt(n,e,r,i):await It(n,e,r,i)}else{if(!("file"in t))throw new Error(`invalid source: ${t}`);{const{file:r,...i}=t;await Lt(n,e,r,i)}}}))),new Rt(n)}}async function Lt(e,t,n,r){const i=await n.url();if(i.startsWith("blob:")){const t=await n.arrayBuffer();await e.registerFileBuffer(n.name,new Uint8Array(t))}else await e.registerFileURL(n.name,i,4);const s=await e.connect();try{switch(n.mimeType){case"text/csv":case"text/tab-separated-values":return await s.insertCSVFromPath(n.name,{name:t,schema:"main",...r}).catch((async e=>{if(e.toString().includes("Could not convert"))return await async function(e,t,n){const r=await e.prepare(`CREATE TABLE '${n}' AS SELECT * FROM read_csv_auto(?, ALL_VARCHAR=TRUE)`);return await r.send(t.name)}(s,n,t);throw e}));case"application/json":return await s.insertJSONFromPath(n.name,{name:t,schema:"main",...r});default:if(/\.arrow$/i.test(n.name)){const e=new Uint8Array(await n.arrayBuffer());return await s.insertArrowFromIPCStream(e,{name:t,schema:"main",...r})}if(/\.parquet$/i.test(n.name))return await s.query(`CREATE VIEW '${t}' AS SELECT * FROM parquet_scan('${n.name}')`);throw new Error(`unknown file type: ${n.mimeType}`)}}finally{await s.close()}}async function qt(e,t,n,r){const i=await e.connect();try{await i.insertArrowTable(n,{name:t,schema:"main",...r})}finally{await i.close()}}async function It(e,t,n,r){const i=(await Mt()).tableFromJSON(n);return await qt(e,t,i,r)}function Ut(e){switch(e){case"BIGINT":case"HUGEINT":case"UBIGINT":return"bigint";case"DOUBLE":case"REAL":case"FLOAT":return"number";case"INTEGER":case"SMALLINT":case"TINYINT":case"USMALLINT":case"UINTEGER":case"UTINYINT":return"integer";case"BOOLEAN":return"boolean";case"DATE":case"TIMESTAMP":case"TIMESTAMP WITH TIME ZONE":return"date";case"VARCHAR":case"UUID":return"string";default:return/^DECIMAL\(/.test(e)?"integer":"other"}}Object.defineProperty(Rt.prototype,"dialect",{value:"duckdb"});const Dt=20;function Bt(e){return Array.isArray(e)&&(Ht(e.schema)||Ft(e.columns)||function(e){const t=Math.min(Dt,e.length);for(let n=0;n<t;++n){const t=e[n];if(null===t||"object"!=typeof t)return!1}return t>0&&function(e){for(const t in e)return!0;return!1}(e[0])}(e)||Vt(e)||Gt(e))||Yt(e)}function Ht(e){return Array.isArray(e)&&e.every(zt)}function Ft(e){return Array.isArray(e)&&e.every((e=>"string"==typeof e))}function zt(e){return e&&"string"==typeof e.name&&"string"==typeof e.type}function Wt(e){return Yt(e)||Vt(e)||Gt(e)}function Vt(e){const t=Math.min(Dt,e.length);if(!(t>0))return!1;let n,r=!1;for(let i=0;i<t;++i){const t=e[i];if(null==t)continue;const s=typeof t;if(void 0===n)switch(s){case"number":case"boolean":case"string":case"bigint":n=s;break;default:return!1}else if(s!==n)return!1;r=!0}return r}function Gt(e){const t=Math.min(Dt,e.length);if(!(t>0))return!1;let n=!1;for(let r=0;r<t;++r){const t=e[r];if(null!=t){if(!(t instanceof Date))return!1;n=!0}}return n}function Yt(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}const Zt=Object.assign((async(e,t,n,r)=>{if(e=await Kt(await e,r),(i=e)&&("function"==typeof i.sql||"function"==typeof i.queryTag&&("function"==typeof i.query||"function"==typeof i.queryStream))&&("table"!==s||"function"==typeof i.describeColumns)&&i!==Zt)return en(e,function(e,t){const n="function"==typeof t.escape?t.escape:e=>e,{select:r,from:i,filter:s,sort:o,slice:a}=e;if(!i.table)throw new Error("missing from table");if(r.columns&&0===r.columns.length)throw new Error("at least one column must be selected");const l=new Map(e.names?.map((({column:e,name:t})=>[e,t]))),c=r.columns?r.columns.map((e=>{const t=l.get(e);return t?`${n(e)} AS ${n(t)}`:n(e)})).join(", "):"*",u=[[`SELECT ${c} FROM ${tn(i.table,n)}`]];for(let e=0;e<s.length;++e)nn(e?"\nAND ":"\nWHERE ",u),sn(s[e],u,n);for(let e=0;e<o.length;++e)nn(e?", ":"\nORDER BY ",u),rn(o[e],u,n);if("mssql"===t.dialect||"oracle"===t.dialect){if(null!==a.to||null!==a.from){if(!o.length){if(!r.columns)throw new Error("at least one column must be explicitly specified. Received '*'.");nn("\nORDER BY ",u),rn({column:r.columns[0],direction:"ASC"},u,n)}nn(`\nOFFSET ${a.from||0} ROWS`,u),nn(`\nFETCH NEXT ${null!==a.to?a.to-(a.from||0):1e9} ROWS ONLY`,u)}}else null===a.to&&null===a.from||nn("\nLIMIT "+(null!==a.to?a.to-(a.from||0):1e9),u),null!==a.from&&nn(` OFFSET ${a.from}`,u);return u}(t,e),n);var i,s;if(Bt(e))return function(e,t){const n=e;let{schema:r,columns:i}=e,s=!1;Ht(r)||(r=xn(e,Ft(i)?i:void 0),s=!0);const o=new Map(r.map((({name:e,type:t})=>[e,t])));if(t.types){for(const{name:e,type:i}of t.types){o.set(e,i),r===n.schema&&(r=r.slice());const t=r.findIndex((t=>t.name===e));t>-1&&(r[t]={...r[t],type:i})}e=e.map((e=>An(e,o,r)))}else s&&(e=e.map((e=>An(e,o,r))));for(const{type:n,operands:r}of t.filter){const[{value:t}]=r,i=r.slice(1).map((({value:e})=>e));switch(n){case"v":{const[n]=i,r=_n(n);e=e.filter((e=>r(e[t])));break}case"nv":{const[n]=i,r=_n(n);e=e.filter((e=>!r(e[t])));break}case"eq":{const[n]=i;if(n instanceof Date){const r=+n;e=e.filter((e=>+e[t]===r))}else e=e.filter((e=>e[t]===n));break}case"ne":{const[n]=i;e=e.filter((e=>e[t]!==n));break}case"c":{const[n]=i;e=e.filter((e=>"string"==typeof e[t]&&e[t].includes(n)));break}case"nc":{const[n]=i;e=e.filter((e=>"string"==typeof e[t]&&!e[t].includes(n)));break}case"in":{const n=new Set(i);e=e.filter((e=>n.has(e[t])));break}case"nin":{const n=new Set(i);e=e.filter((e=>!n.has(e[t])));break}case"n":e=e.filter((e=>null==e[t]));break;case"nn":e=e.filter((e=>null!=e[t]));break;case"lt":{const[n]=i;e=e.filter((e=>e[t]<n));break}case"lte":{const[n]=i;e=e.filter((e=>e[t]<=n));break}case"gt":{const[n]=i;e=e.filter((e=>e[t]>n));break}case"gte":{const[n]=i;e=e.filter((e=>e[t]>=n));break}default:throw new Error(`unknown filter type: ${n}`)}}for(const{column:r,direction:i}of function(e){if("function"!=typeof e[Symbol.iterator])throw new TypeError("values is not iterable");return Array.from(e).reverse()}(t.sort)){const t="desc"===i?cn:ln;e===n&&(e=e.slice()),e.sort(((e,n)=>t(e[r],n[r])))}let{from:a,to:l}=t.slice;a=null==a?0:Math.max(0,a),l=null==l?1/0:Math.max(0,l),(a>0||l<1/0)&&(e=e.slice(Math.max(0,a),Math.max(0,l)));if(t.select.columns){if(r){const e=new Map(r.map((e=>[e.name,e])));r=t.select.columns.map((t=>e.get(t)))}i&&(i=t.select.columns),e=e.map((e=>Object.fromEntries(t.select.columns.map((t=>[t,e[t]])))))}if(t.names){const n=new Map(t.names.map((e=>[e.column,e])));r&&(r=r.map((e=>{const t=n.get(e.name);return{...e,...t?{name:t.name}:null}}))),i&&(i=i.map((e=>{const t=n.get(e);return t?.name??e}))),e=e.map((e=>Object.fromEntries(Object.keys(e).map((t=>{const r=n.get(t);return[r?.name??t,e[t]]})))))}e!==n&&(r&&(e.schema=r),i&&(e.columns=i));return e}(e,t);if(!e)throw new Error("missing data source");throw new Error("invalid data source")}),{sql:(e,t,n)=>async function(){return en(await Xt(await e,n),arguments,t)}});function Jt(e){const t=new WeakMap;return(n,r)=>{if(!n)throw new Error("data source not found");let i=t.get(n);return(!i||Bt(n)&&n.length!==i._numRows)&&(i=e(n,r),i._numRows=n.length,t.set(n,i)),i}}const Kt=Jt((async(e,t)=>{if(e instanceof Mn){switch(e.mimeType){case"text/csv":return e.csv();case"text/tab-separated-values":return e.tsv();case"application/json":return e.json();case"application/x-sqlite3":return e.sqlite()}if(/\.(arrow|parquet)$/i.test(e.name))return Qt(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return Ct(e)||jt(e)?Qt(e,t):Bt(e)&&Wt(e)?Array.from(e,(e=>({value:e}))):e})),Xt=Jt((async(e,t)=>{if(e instanceof Mn){switch(e.mimeType){case"text/csv":case"text/tab-separated-values":case"application/json":return Qt(e,t);case"application/x-sqlite3":return e.sqlite()}if(/\.(arrow|parquet)$/i.test(e.name))return Qt(e,t);throw new Error(`unsupported file type: ${e.mimeType}`)}return Bt(e)?Qt(await async function(e,t){const n=await Mt();return Wt(e)?n.tableFromArrays({[t]:e}):n.tableFromJSON(e)}(e,t),t):Ct(e)||jt(e)?Qt(e,t):e}));function Qt(e,t=(e instanceof Mn?function(e){return e.name.replace(/@\d+(?=\.|$)/,"").replace(/\.\w+$/,"")}(e):"__table")){return Rt.of({[t]:e})}async function en(e,t,n){if(!e)throw new Error("missing data source");if("function"==typeof e.queryTag){const r=new AbortController,i={signal:r.signal};if(n.then((()=>r.abort("invalidated"))),"function"==typeof e.queryStream)return async function*(e){let t=performance.now();const n=await e,r=[];r.done=!1,r.error=null,r.schema=n.schema;try{for await(const e of n.readRows()){performance.now()-t>150&&r.length>0&&(yield r,t=performance.now());for(const t of e)r.push(t)}r.done=!0,yield r}catch(e){r.error=e,yield r}}(e.queryStream(...e.queryTag.apply(e,t),i));if("function"==typeof e.query)return e.query(...e.queryTag.apply(e,t),i)}if("function"==typeof e.sql)return e.sql.apply(e,t);throw new Error("source does not implement query, queryStream, or sql")}function tn(e,t){if("object"==typeof e){let n="";return null!=e.database&&(n+=t(e.database)+"."),null!=e.schema&&(n+=t(e.schema)+"."),n+=t(e.table),n}return t(e)}function nn(e,t){const n=t[0];n[n.length-1]+=e}function rn({column:e,direction:t},n,r){nn(`${r(e)} ${t.toUpperCase()}`,n)}function sn({type:e,operands:t},n,r){if(t.length<1)throw new Error("Invalid operand length");if(1===t.length||"v"===e||"nv"===e)switch(on(t[0],n,r),e){case"n":case"nv":return void nn(" IS NULL",n);case"nn":case"v":return void nn(" IS NOT NULL",n);default:throw new Error("Invalid filter operation")}if(2!==t.length||["in","nin"].includes(e)){var i;switch(on(t[0],n,r),e){case"in":nn(" IN (",n);break;case"nin":nn(" NOT IN (",n);break;default:throw new Error("Invalid filter operation")}!function(e,t){let n=!0;for(const r of e)n?n=!1:nn(",",t),t.push(r.value),t[0].push("")}(t.slice(1),n),nn(")",n)}else{if(["c","nc"].includes(e)){switch(on(t[0],n,r),e){case"c":nn(" LIKE ",n);break;case"nc":nn(" NOT LIKE ",n)}return void on((i=t[1],{...i,value:`%${i.value}%`}),n,r)}switch(on(t[0],n,r),e){case"eq":nn(" = ",n);break;case"ne":nn(" <> ",n);break;case"gt":nn(" > ",n);break;case"lt":nn(" < ",n);break;case"gte":nn(" >= ",n);break;case"lte":nn(" <= ",n);break;default:throw new Error("Invalid filter operation")}on(t[1],n,r)}}function on(e,t,n){"column"===e.type?nn(n(e.value),t):(t.push(e.value),t[0].push(""))}function an(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))}function ln(e,t){return an(e,t)||(e<t?-1:e>t?1:0)}function cn(e,t){return an(e,t)||(e>t?-1:e<t?1:0)}const un=e=>"number"==typeof e&&!Number.isNaN(e),dn=e=>Number.isInteger(e)&&!Number.isNaN(e),fn=e=>"string"==typeof e,hn=e=>"boolean"==typeof e,pn=e=>"bigint"==typeof e,mn=e=>e instanceof Date&&!isNaN(e),vn=e=>e instanceof ArrayBuffer,yn=e=>Array.isArray(e),bn=e=>"object"==typeof e&&null!==e,wn=e=>null!=e;function _n(e){switch(e){case"string":return fn;case"bigint":return pn;case"boolean":return hn;case"number":return un;case"integer":return dn;case"date":return mn;case"buffer":return vn;case"array":return yn;case"object":return bn;default:return wn}}const gn=/^(([-+]\d{2})?\d{4}(-\d{2}(-\d{2}))|(\d{1,2})\/(\d{1,2})\/(\d{2,4}))([T ]\d{2}:\d{2}(:\d{2}(\.\d{3})?)?(Z|[-+]\d{2}:\d{2})?)?$/;function En(e,t){switch(t){case"string":return"string"==typeof e||null==e?e:String(e);case"boolean":if("string"==typeof e){const t=e.trim().toLowerCase();return"true"===t||"false"!==t&&null}return"boolean"==typeof e||null==e?e:Boolean(e);case"bigint":return"bigint"==typeof e||null==e?e:Number.isInteger("string"!=typeof e||e.trim()?+e:NaN)?BigInt(e):void 0;case"integer":case"number":return"number"==typeof e?e:null==e||"string"==typeof e&&!e.trim()?NaN:Number(e);case"date":{if(e instanceof Date||null==e)return e;if("number"==typeof e)return new Date(e);const t=String(e).trim();return"string"!=typeof e||t?new Date(gn.test(t)?t:NaN):null}case"array":case"object":case"buffer":case"other":return e;default:throw new Error(`Unable to coerce to type: ${t}`)}}function An(e,t,n){const r={};for(const i of n){const n=t.get(i.name),s=e[i.name];r[i.name]="raw"===n?s:En(s,n)}return r}const $n=["boolean","integer","number","date","bigint","array","object","buffer"];function xn(e,t=function(e){const t=new Set;for(const n of e)if(n)for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.add(e);return Array.from(t)}(e)){const n=[],r=e.slice(0,100);for(const e of t){const t={boolean:0,integer:0,number:0,date:0,string:0,array:0,object:0,bigint:0,buffer:0,defined:0};for(const n of r){let r=n[e];if(null==r)continue;const i=typeof r;if("string"!==i)++t.defined,Array.isArray(r)?++t.array:r instanceof Date?++t.date:r instanceof ArrayBuffer?++t.buffer:"number"===i?(++t.number,Number.isInteger(r)&&++t.integer):i in t&&++t[i];else{if(r=r.trim(),!r)continue;++t.defined,++t.string,/^(true|false)$/i.test(r)?++t.boolean:r&&!isNaN(r)?(++t.number,Number.isInteger(+r)&&++t.integer):gn.test(r)&&++t.date}}const i=Math.max(1,.9*t.defined),s=Tt($n,(e=>t[e]>=i?t[e]:NaN))??(t.string>=i?"string":"other");n.push({name:e,type:s,inferred:s})}return n}class Sn{constructor(e){Object.defineProperties(this,{_:{value:e},sheetNames:{value:e.worksheets.map((e=>e.name)),enumerable:!0}})}sheet(e,t){const n="number"==typeof e?this.sheetNames[e]:this.sheetNames.includes(e+="")?e:null;if(null==n)throw new Error(`Sheet not found: ${e}`);return function(e,{range:t,headers:n}={}){let[[r,i],[s,o]]=function(e=":",{columnCount:t,rowCount:n}){if(!(e+="").match(/^[A-Z]*\d*:[A-Z]*\d*$/))throw new Error("Malformed range specifier");const[[r=0,i=0],[s=t-1,o=n-1]]=e.split(":").map(jn);return[[r,i],[s,o]]}(t,e);const a=n?e._rows[i++]:null;let l=new Set(["#"]);for(let e=r;e<=s;e++){const t=a?Nn(a.findCell(e+1)):null;let n=t&&t+""||Tn(e);for(;l.has(n);)n+="_";l.add(n)}l=new Array(r).concat(Array.from(l));const c=new Array(o-i+1);for(let t=i;t<=o;t++){const n=c[t-i]=Object.create(null,{"#":{value:t+1}}),o=e.getRow(t+1);if(o.hasValues)for(let e=r;e<=s;e++){const t=Nn(o.findCell(e+1));null!=t&&(n[l[e+1]]=t)}}return c.columns=l.filter((()=>!0)),c}(this._.getWorksheet(n),t)}}function Nn(e){if(!e)return;const{value:t}=e;if(t&&"object"==typeof t&&!(t instanceof Date)){if(t.formula||t.sharedFormula)return t.result&&t.result.error?NaN:t.result;if(t.richText)return kn(t);if(t.text){let{text:e}=t;return e.richText&&(e=kn(e)),t.hyperlink&&t.hyperlink!==e?`${t.hyperlink} ${e}`:e}return t}return t}function kn(e){return e.richText.map((e=>e.text)).join("")}function Tn(e){let t="";e++;do{t=String.fromCharCode(64+(e%26||26))+t}while(e=Math.floor((e-1)/26));return t}function jn(e){const[,t,n]=e.match(/^([A-Z]*)(\d*)$/);let r=0;if(t)for(let e=0;e<t.length;e++)r+=Math.pow(26,t.length-e-1)*(t.charCodeAt(e)-64);return[r?r-1:void 0,n?+n-1:void 0]}async function Cn(e){const t=await fetch(await e.url());if(!t.ok)throw new Error(`Unable to load file: ${e.name}`);return t}async function On(e,t,{array:n=!1,typed:r=!1}={}){const i=await e.text(),s="\t"===t?n?Te:ke:n?Se:xe;if("auto"===r&&!n){const e=s(i);return function(e,t){const n=new Map(t.map((({name:e,type:t})=>[e,t])));return Object.assign(e.map((e=>An(e,n,t))),{schema:t})}(e,xn(e,e.columns))}return s(i,r&&je)}class Pn{constructor(e,t){Object.defineProperty(this,"name",{value:e,enumerable:!0}),void 0!==t&&Object.defineProperty(this,"mimeType",{value:t+"",enumerable:!0})}async blob(){return(await Cn(this)).blob()}async arrayBuffer(){return(await Cn(this)).arrayBuffer()}async text(){return(await Cn(this)).text()}async json(){return(await Cn(this)).json()}async stream(){return(await Cn(this)).body}async csv(e){return On(this,",",e)}async tsv(e){return On(this,"\t",e)}async image(e){const t=await this.url();return new Promise(((n,r)=>{const i=new Image;new URL(t,document.baseURI).origin!==new URL(location).origin&&(i.crossOrigin="anonymous"),Object.assign(i,e),i.onload=()=>n(i),i.onerror=()=>r(new Error(`Unable to load file: ${this.name}`)),i.src=t}))}async arrow({version:e=4}={}){switch(e){case 4:{const[e,t]=await Promise.all([gt(Ge.resolve()),Cn(this)]);return e.Table.from(t)}case 9:{const[e,t]=await Promise.all([import(`${wt}${Ye.resolve()}`),Cn(this)]);return e.tableFromIPC(t)}case 11:{const[e,t]=await Promise.all([import(`${wt}${Ze.resolve()}`),Cn(this)]);return e.tableFromIPC(t)}default:throw new Error(`unsupported arrow version: ${e}`)}}async sqlite(){return At.open(Cn(this))}async zip(){const[e,t]=await Promise.all([gt(Be.resolve()),this.arrayBuffer()]);return new Ln(await e.loadAsync(t))}async xml(e="application/xml"){return(new DOMParser).parseFromString(await this.text(),e)}async html(){return this.xml("text/html")}async xlsx(){const[e,t]=await Promise.all([gt(Xe.resolve()),this.arrayBuffer()]);return new Sn(await(new e.Workbook).xlsx.load(t))}}let Mn=class extends Pn{constructor(e,t,n){super(t,n),Object.defineProperty(this,"_url",{value:e})}async url(){return await this._url+""}};function Rn(e){throw new Error(`File not found: ${e}`)}class Ln{constructor(e){Object.defineProperty(this,"_",{value:e}),this.filenames=Object.keys(e.files).filter((t=>!e.files[t].dir))}file(e){const t=this._.file(e+="");if(!t||t.dir)throw new Error(`file not found: ${e}`);return new qn(t)}}class qn extends Pn{constructor(e){super(e.name),Object.defineProperty(this,"_",{value:e}),Object.defineProperty(this,"_url",{writable:!0})}async url(){return this._url||(this._url=this.blob().then(URL.createObjectURL))}async blob(){return this._.async("blob")}async arrayBuffer(){return this._.async("arraybuffer")}async text(){return this._.async("text")}async json(){return JSON.parse(await this.text())}}var In={math:"http://www.w3.org/1998/Math/MathML",svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};var Un=0;function Dn(e){return new Bn("O-"+(null==e?"":e+"-")+ ++Un)}function Bn(e){this.id=e,this.href=new URL(`#${e}`,location)+""}Bn.prototype.toString=function(){return"url("+this.href+")"};var Hn=Object.freeze({__proto__:null,canvas:function(e,t){var n=document.createElement("canvas");return n.width=e,n.height=t,n},context2d:function(e,t,n){null==n&&(n=devicePixelRatio);var r=document.createElement("canvas");r.width=e*n,r.height=t*n,r.style.width=e+"px";var i=r.getContext("2d");return i.scale(n,n),i},download:function(e,t="untitled",n="Save"){const r=document.createElement("a"),i=r.appendChild(document.createElement("button"));async function s(){await new Promise(requestAnimationFrame),URL.revokeObjectURL(r.href),r.removeAttribute("href"),i.textContent=n,i.disabled=!1}return i.textContent=n,r.download=t,r.onclick=async t=>{if(i.disabled=!0,r.href)return s();i.textContent="Saving…";try{const t=await("function"==typeof e?e():e);i.textContent="Download",r.href=URL.createObjectURL(t)}catch(e){i.textContent=n}if(t.eventPhase)return s();i.disabled=!1},r},element:function(e,t){var n,r=e+="",i=r.indexOf(":");i>=0&&"xmlns"!==(r=e.slice(0,i))&&(e=e.slice(i+1));var s=In.hasOwnProperty(r)?document.createElementNS(In[r],e):document.createElement(e);if(t)for(var o in t)i=(r=o).indexOf(":"),n=t[o],i>=0&&"xmlns"!==(r=o.slice(0,i))&&(o=o.slice(i+1)),In.hasOwnProperty(r)?s.setAttributeNS(In[r],o,n):s.setAttribute(o,n);return s},input:function(e){var t=document.createElement("input");return null!=e&&(t.type=e),t},range:function(e,t,n){1===arguments.length&&(t=e,e=null);var r=document.createElement("input");return r.min=e=null==e?0:+e,r.max=t=null==t?1:+t,r.step=null==n?"any":n=+n,r.type="range",r},select:function(e){var t=document.createElement("select");return Array.prototype.forEach.call(e,(function(e){var n=document.createElement("option");n.value=n.textContent=e,t.appendChild(n)})),t},svg:function(e,t){var n=document.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("viewBox",[0,0,e,t]),n.setAttribute("width",e),n.setAttribute("height",t),n},text:function(e){return document.createTextNode(e)},uid:Dn});var Fn=Object.freeze({__proto__:null,buffer:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsArrayBuffer(e)}))},text:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsText(e)}))},url:function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(){t(r.result)},r.onerror=n,r.readAsDataURL(e)}))}});function zn(){return this}function Wn(e,t){let n=!1;if("function"!=typeof t)throw new Error("dispose is not a function");return{[Symbol.iterator]:zn,next:()=>n?{done:!0}:(n=!0,{done:!1,value:e}),return:()=>(n=!0,t(e),{done:!0}),throw:()=>({done:n=!0})}}function Vn(e){let t,n,r=!1;const i=e((function(e){n?(n(e),n=null):r=!0;return t=e}));if(null!=i&&"function"!=typeof i)throw new Error("function"==typeof i.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:zn,throw:()=>({done:!0}),return:()=>(null!=i&&i(),{done:!0}),next:function(){return{done:!1,value:r?(r=!1,Promise.resolve(t)):new Promise((e=>n=e))}}}}function Gn(e){switch(e.type){case"range":case"number":return e.valueAsNumber;case"date":return e.valueAsDate;case"checkbox":return e.checked;case"file":return e.multiple?e.files:e.files[0];case"select-multiple":return Array.from(e.selectedOptions,(e=>e.value));default:return e.value}}var Yn=Object.freeze({__proto__:null,disposable:Wn,filter:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)t(n.value,++r)&&(yield n.value)},input:function(e){return Vn((function(t){var n=function(e){switch(e.type){case"button":case"submit":case"checkbox":return"click";case"file":return"change";default:return"input"}}(e),r=Gn(e);function i(){t(Gn(e))}return e.addEventListener(n,i),void 0!==r&&t(r),function(){e.removeEventListener(n,i)}}))},map:function*(e,t){for(var n,r=-1;!(n=e.next()).done;)yield t(n.value,++r)},observe:Vn,queue:function(e){let t;const n=[],r=e((function(e){n.push(e),t&&(t(n.shift()),t=null);return e}));if(null!=r&&"function"!=typeof r)throw new Error("function"==typeof r.then?"async initializers are not supported":"initializer returned something, but not a dispose function");return{[Symbol.iterator]:zn,throw:()=>({done:!0}),return:()=>(null!=r&&r(),{done:!0}),next:function(){return{done:!1,value:n.length?Promise.resolve(n.shift()):new Promise((e=>t=e))}}}},range:function*(e,t,n){e=+e,t=+t,n=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+n;for(var r=-1,i=0|Math.max(0,Math.ceil((t-e)/n));++r<i;)yield e+r*n},valueAt:function(e,t){if(!(!isFinite(t=+t)||t<0||t!=t|0))for(var n,r=-1;!(n=e.next()).done;)if(++r===t)return n.value},worker:function(e){const t=URL.createObjectURL(new Blob([e],{type:"text/javascript"})),n=new Worker(t);return Wn(n,(()=>{n.terminate(),URL.revokeObjectURL(t)}))}});function Zn(e,t){return function(n){var r,i,s,o,a,l,c,u,d=n[0],f=[],h=null,p=-1;for(a=1,l=arguments.length;a<l;++a){if((r=arguments[a])instanceof Node)f[++p]=r,d+="\x3c!--o:"+p+"--\x3e";else if(Array.isArray(r)){for(c=0,u=r.length;c<u;++c)(i=r[c])instanceof Node?(null===h&&(f[++p]=h=document.createDocumentFragment(),d+="\x3c!--o:"+p+"--\x3e"),h.appendChild(i)):(h=null,d+=i);h=null}else d+=r;d+=n[a]}if(h=e(d),++p>0){for(s=new Array(p),o=document.createTreeWalker(h,NodeFilter.SHOW_COMMENT,null,!1);o.nextNode();)i=o.currentNode,/^o:/.test(i.nodeValue)&&(s[+i.nodeValue.slice(2)]=i);for(a=0;a<p;++a)(i=s[a])&&i.parentNode.replaceChild(f[a],i)}return 1===h.childNodes.length?h.removeChild(h.firstChild):11===h.nodeType?((i=t()).appendChild(h),i):h}}const Jn=Zn((function(e){var t=document.createElement("template");return t.innerHTML=e.trim(),document.importNode(t.content,!0)}),(function(){return document.createElement("span")}));function Kn(e){let t;Object.defineProperties(this,{generator:{value:Vn((e=>{t=e}))},value:{get:()=>e,set:n=>t(e=n)}}),void 0!==e&&t(e)}function*Xn(){for(;;)yield Date.now()}var Qn=new Map;function er(e,t){var n;return(n=Qn.get(e=+e))?n.then((()=>t)):(n=Date.now())>=e?Promise.resolve(t):function(e,t){var n=new Promise((function(n){Qn.delete(t);var r=t-e;if(!(r>0))throw new Error("invalid time");if(r>2147483647)throw new Error("too long to wait");setTimeout(n,r)}));return Qn.set(t,n),n}(n,e).then((()=>t))}var tr=Object.freeze({__proto__:null,delay:function(e,t){return new Promise((function(n){setTimeout((function(){n(t)}),e)}))},tick:function(e,t){return er(Math.ceil((Date.now()+1)/e)*e,t)},when:er});function nr(e,t){if(/^(\w+:)|\/\//i.test(e))return e;if(/^[.]{0,2}\//i.test(e))return new URL(e,t??location).href;if(!e.length||/^[\s._]/.test(e)||/\s$/.test(e))throw new Error("illegal name");return"https://unpkg.com/"+e}const rr=Zn((function(e){var t=document.createElementNS("http://www.w3.org/2000/svg","g");return t.innerHTML=e.trim(),t}),(function(){return document.createElementNS("http://www.w3.org/2000/svg","g")}));var ir=String.raw;function sr(e){return new Promise((function(t,n){var r=document.createElement("link");r.rel="stylesheet",r.href=e,r.onerror=n,r.onload=t,document.head.appendChild(r)}))}function or(){return Vn((function(e){var t=e(document.body.clientWidth);function n(){var n=document.body.clientWidth;n!==t&&e(t=n)}return window.addEventListener("resize",n),function(){window.removeEventListener("resize",n)}}))}const ar=Object.assign(Object.defineProperties((function(e){const t=function(e){return null==e?gt:pt(e)}(e);var n;Object.defineProperties(this,(n={FileAttachment:()=>Rn,Mutable:()=>Kn,now:Xn,width:or,dot:()=>t(Le.resolve()),htl:()=>t(De.resolve()),html:()=>Jn,md:()=>function(e){return e(He.resolve()).then((function(t){return Zn((function(n){var r=document.createElement("div");r.innerHTML=t(n,{langPrefix:""}).trim();var i=r.querySelectorAll("pre code[class]");return i.length>0&&e(qe.resolve()).then((function(t){i.forEach((function(n){function r(){t.highlightBlock(n),n.parentNode.classList.add("observablehq--md-pre")}t.getLanguage(n.className)?r():e(qe.resolve("async-languages/index.js")).then((r=>{if(r.has(n.className))return e(qe.resolve("async-languages/"+r.get(n.className))).then((e=>{t.registerLanguage(n.className,e)}))})).then(r,r)}))})),r}),(function(){return document.createElement("div")}))}))}(t),svg:()=>rr,tex:()=>function(e){return Promise.all([e(Ie.resolve()),e.resolve(Ie.resolve("dist/katex.min.css")).then(sr)]).then((function(e){var t=e[0],n=r();function r(e){return function(){var n=document.createElement("div");return t.render(ir.apply(String,arguments),n,e),n.removeChild(n.firstChild)}}return n.options=r,n.block=r({displayMode:!0}),n}))}(t),_:()=>t(Ue.resolve()),aq:()=>t.alias({"apache-arrow":Ge.resolve()})(Je.resolve()),Arrow:()=>t(Ge.resolve()),d3:()=>t(Pe.resolve()),DuckDBClient:()=>Rt,Inputs:()=>t(Me.resolve()).then((e=>({...e,file:e.fileOf(Pn)}))),L:()=>async function(e){const t=await e(et.resolve());if(!t._style){const n=document.createElement("link");n.rel="stylesheet",n.href=await e.resolve(et.resolve("dist/leaflet.css")),t._style=document.head.appendChild(n)}return t}(t),mermaid:()=>async function(e){const t=await e(Qe.resolve());return t.initialize({securityLevel:"loose",theme:"neutral"}),function(){const e=document.createElement("div");return e.innerHTML=t.render(Dn().id,String.raw.apply(String,arguments)),e.removeChild(e.firstChild)}}(t),Plot:()=>t(Re.resolve()),__query:()=>Zt,require:()=>t,resolve:()=>nr,SQLite:()=>Et(t),SQLiteDatabaseClient:()=>At,topojson:()=>t(Ke.resolve()),vl:()=>async function(e){const[t,n,r]=await Promise.all([ze,We,Ve].map((t=>e(t.resolve()))));return r.register(t,n)}(t),aapl:()=>new Mn("https://static.observableusercontent.com/files/3ccff97fd2d93da734e76829b2b066eafdaac6a1fafdec0faf6ebc443271cfc109d29e80dd217468fcb2aff1e6bffdc73f356cc48feb657f35378e6abbbb63b9").csv({typed:!0}),alphabet:()=>new Mn("https://static.observableusercontent.com/files/75d52e6c3130b1cae83cda89305e17b50f33e7420ef205587a135e8562bcfd22e483cf4fa2fb5df6dff66f9c5d19740be1cfaf47406286e2eb6574b49ffc685d").csv({typed:!0}),cars:()=>new Mn("https://static.observableusercontent.com/files/048ec3dfd528110c0665dfa363dd28bc516ffb7247231f3ab25005036717f5c4c232a5efc7bb74bc03037155cb72b1abe85a33d86eb9f1a336196030443be4f6").csv({typed:!0}),citywages:()=>new Mn("https://static.observableusercontent.com/files/39837ec5121fcc163131dbc2fe8c1a2e0b3423a5d1e96b5ce371e2ac2e20a290d78b71a4fb08b9fa6a0107776e17fb78af313b8ea70f4cc6648fad68ddf06f7a").csv({typed:!0}),diamonds:()=>new Mn("https://static.observableusercontent.com/files/87942b1f5d061a21fa4bb8f2162db44e3ef0f7391301f867ab5ba718b225a63091af20675f0bfe7f922db097b217b377135203a7eab34651e21a8d09f4e37252").csv({typed:!0}),flare:()=>new Mn("https://static.observableusercontent.com/files/a6b0d94a7f5828fd133765a934f4c9746d2010e2f342d335923991f31b14120de96b5cb4f160d509d8dc627f0107d7f5b5070d2516f01e4c862b5b4867533000").csv({typed:!0}),industries:()=>new Mn("https://static.observableusercontent.com/files/76f13741128340cc88798c0a0b7fa5a2df8370f57554000774ab8ee9ae785ffa2903010cad670d4939af3e9c17e5e18e7e05ed2b38b848ac2fc1a0066aa0005f").csv({typed:!0}),miserables:()=>new Mn("https://static.observableusercontent.com/files/31d904f6e21d42d4963ece9c8cc4fbd75efcbdc404bf511bc79906f0a1be68b5a01e935f65123670ed04e35ca8cae3c2b943f82bf8db49c5a67c85cbb58db052").json(),olympians:()=>new Mn("https://static.observableusercontent.com/files/31ca24545a0603dce099d10ee89ee5ae72d29fa55e8fc7c9ffb5ded87ac83060d80f1d9e21f4ae8eb04c1e8940b7287d179fe8060d887fb1f055f430e210007c").csv({typed:!0}),penguins:()=>new Mn("https://static.observableusercontent.com/files/715db1223e067f00500780077febc6cebbdd90c151d3d78317c802732252052ab0e367039872ab9c77d6ef99e5f55a0724b35ddc898a1c99cb14c31a379af80a").csv({typed:!0}),weather:()=>new Mn("https://static.observableusercontent.com/files/693a46b22b33db0f042728700e0c73e836fa13d55446df89120682d55339c6db7cc9e574d3d73f24ecc9bc7eb9ac9a1e7e104a1ee52c00aab1e77eb102913c1f").csv({typed:!0}),DOM:Hn,Files:Fn,Generators:Yn,Promises:tr},Object.fromEntries(Object.entries(n).map(lr))))}),{resolve:{get:()=>gt.resolve,enumerable:!0,configurable:!0},require:{get:()=>gt,set:function(e){gt=e},enumerable:!0,configurable:!0}}),{resolveFrom:ft,requireFrom:pt});function lr([e,t]){return[e,{value:t,writable:!0,enumerable:!0}]}class cr extends Error{constructor(e,t){super(e),this.input=t}}function ur(e){return()=>e}function dr(e){return e}cr.prototype.name="RuntimeError";const fr=Array.prototype.map;function hr(){}const pr=1,mr=2,vr=3,yr=Symbol("no-observer");function br(e,t,n){var r;n||(n=yr),Object.defineProperties(this,{_observer:{value:n,writable:!0},_definition:{value:gr,writable:!0},_duplicate:{value:void 0,writable:!0},_duplicates:{value:void 0,writable:!0},_indegree:{value:NaN,writable:!0},_inputs:{value:[],writable:!0},_invalidate:{value:hr,writable:!0},_module:{value:t},_name:{value:null,writable:!0},_outputs:{value:new Set,writable:!0},_promise:{value:Promise.resolve(void 0),writable:!0},_reachable:{value:n!==yr,writable:!0},_rejector:{value:(r=this,e=>{if(e===Er)throw e;if(e===gr)throw new cr(`${r._name} is not defined`,r._name);if(e instanceof Error&&e.message)throw new cr(e.message,r._name);throw new cr(`${r._name} could not be resolved`,r._name)})},_type:{value:e},_value:{value:void 0,writable:!0},_version:{value:0,writable:!0}})}function wr(e){e._module._runtime._dirty.add(e),e._outputs.add(this)}function _r(e){e._module._runtime._dirty.add(e),e._outputs.delete(this)}function gr(){throw gr}function Er(){throw Er}function Ar(e){return()=>{throw new cr(`${e} is defined more than once`)}}function $r(e,t,n){const r=this._module._scope,i=this._module._runtime;if(this._inputs.forEach(_r,this),t.forEach(wr,this),this._inputs=t,this._definition=n,this._value=void 0,n===hr?i._variables.delete(this):i._variables.add(this),e!==this._name||r.get(e)!==this){let t,s;if(this._name)if(this._outputs.size)r.delete(this._name),s=this._module._resolve(this._name),s._outputs=this._outputs,this._outputs=new Set,s._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(this)]=s}),this),s._outputs.forEach(i._updates.add,i._updates),i._dirty.add(s).add(this),r.set(this._name,s);else if((s=r.get(this._name))===this)r.delete(this._name);else{if(s._type!==vr)throw new Error;s._duplicates.delete(this),this._duplicate=void 0,1===s._duplicates.size&&(s=s._duplicates.keys().next().value,t=r.get(this._name),s._outputs=t._outputs,t._outputs=new Set,s._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(t)]=s})),s._definition=s._duplicate,s._duplicate=void 0,i._dirty.add(t).add(s),i._updates.add(s),r.set(this._name,s))}if(this._outputs.size)throw new Error;e&&((s=r.get(e))?s._type===vr?(this._definition=Ar(e),this._duplicate=n,s._duplicates.add(this)):s._type===mr?(this._outputs=s._outputs,s._outputs=new Set,this._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(s)]=this}),this),i._dirty.add(s).add(this),r.set(e,this)):(s._duplicate=s._definition,this._duplicate=n,t=new br(vr,this._module),t._name=e,t._definition=this._definition=s._definition=Ar(e),t._outputs=s._outputs,s._outputs=new Set,t._outputs.forEach((function(e){e._inputs[e._inputs.indexOf(s)]=t})),t._duplicates=new Set([this,s]),i._dirty.add(s).add(t),i._updates.add(s).add(t),r.set(e,t)):r.set(e,this)),this._name=e}return this._version>0&&++this._version,i._updates.add(this),i._compute(),this}Object.defineProperties(br.prototype,{_pending:{value:function(){this._observer.pending&&this._observer.pending()},writable:!0,configurable:!0},_fulfilled:{value:function(e){this._observer.fulfilled&&this._observer.fulfilled(e,this._name)},writable:!0,configurable:!0},_rejected:{value:function(e){this._observer.rejected&&this._observer.rejected(e,this._name)},writable:!0,configurable:!0},define:{value:function(e,t,n){switch(arguments.length){case 1:n=e,e=t=null;break;case 2:n=t,"string"==typeof e?t=null:(t=e,e=null)}return $r.call(this,null==e?null:String(e),null==t?[]:fr.call(t,this._module._resolve,this._module),"function"==typeof n?n:ur(n))},writable:!0,configurable:!0},delete:{value:function(){return $r.call(this,null,[],hr)},writable:!0,configurable:!0},import:{value:function(e,t,n){arguments.length<3&&(n=t,t=e);return $r.call(this,String(t),[n._resolve(String(e))],dr)},writable:!0,configurable:!0}});const xr=Symbol("variable"),Sr=Symbol("invalidation"),Nr=Symbol("visibility");function kr(e,t=[]){Object.defineProperties(this,{_runtime:{value:e},_scope:{value:new Map},_builtins:{value:new Map([["@variable",xr],["invalidation",Sr],["visibility",Nr],...t])},_source:{value:null,writable:!0}})}async function Tr(e,t){await e._compute();try{return await t._promise}catch(n){if(n===Er)return Tr(e,t);throw n}}function jr(e){return e._name}Object.defineProperties(kr.prototype,{_resolve:{value:function(e){let t,n=this._scope.get(e);if(!n)if(n=new br(mr,this),this._builtins.has(e))n.define(e,ur(this._builtins.get(e)));else if(this._runtime._builtin._scope.has(e))n.import(e,this._runtime._builtin);else{try{t=this._runtime._global(e)}catch(t){return n.define(e,function(e){return()=>{throw e}}(t))}void 0===t?this._scope.set(n._name=e,n):n.define(e,ur(t))}return n},writable:!0,configurable:!0},redefine:{value:function(e){const t=this._scope.get(e);if(!t)throw new cr(`${e} is not defined`);if(t._type===vr)throw new cr(`${e} is defined more than once`);return t.define.apply(t,arguments)},writable:!0,configurable:!0},define:{value:function(){const e=new br(pr,this);return e.define.apply(e,arguments)},writable:!0,configurable:!0},derive:{value:function(e,t){const n=new Map,r=new Set,i=[];function s(e){let t=n.get(e);return t||(t=new kr(e._runtime,e._builtins),t._source=e,n.set(e,t),i.push([t,e]),r.add(e),t)}const o=s(this);for(const n of e){const{alias:e,name:r}="object"==typeof n?n:{name:n};o.import(r,e??r,t)}for(const e of r)for(const[t,n]of e._scope)if(n._definition===dr){if(e===this&&o._scope.has(t))continue;const r=n._inputs[0]._module;r._source&&s(r)}for(const[e,t]of i)for(const[r,i]of t._scope){const t=e._scope.get(r);if(!t||t._type===mr)if(i._definition===dr){const t=i._inputs[0],s=t._module;e.import(t._name,r,n.get(s)||s)}else e.define(r,i._inputs.map(jr),i._definition)}return o},writable:!0,configurable:!0},import:{value:function(){const e=new br(pr,this);return e.import.apply(e,arguments)},writable:!0,configurable:!0},value:{value:async function(e){let t=this._scope.get(e);if(!t)throw new cr(`${e} is not defined`);if(t._observer!==yr)return Tr(this._runtime,t);t=this.variable(!0).define([e],dr);try{return await Tr(this._runtime,t)}finally{t.delete()}},writable:!0,configurable:!0},variable:{value:function(e){return new br(pr,this,e)},writable:!0,configurable:!0},builtin:{value:function(e,t){this._builtins.set(e,t)},writable:!0,configurable:!0}});const Cr="function"==typeof requestAnimationFrame?requestAnimationFrame:"function"==typeof setImmediate?setImmediate:e=>setTimeout(e,0);function Or(e=new ar,t=Br){const n=this.module();if(Object.defineProperties(this,{_dirty:{value:new Set},_updates:{value:new Set},_precomputes:{value:[],writable:!0},_computing:{value:null,writable:!0},_init:{value:null,writable:!0},_modules:{value:new Map},_variables:{value:new Set},_disposed:{value:!1,writable:!0},_builtin:{value:n},_global:{value:t}}),e)for(const t in e)new br(mr,n).define(t,[],e[t])}function Pr(e){const t=new Set(e._inputs);for(const n of t){if(n===e)return!0;n._inputs.forEach(t.add,t)}return!1}function Mr(e){++e._indegree}function Rr(e){--e._indegree}function Lr(e){return e._promise.catch(e._rejector)}function qr(e){return new Promise((function(t){e._invalidate=t}))}function Ir(e,t){let n,r,i="function"==typeof IntersectionObserver&&t._observer&&t._observer._node,s=!i,o=hr,a=hr;return i&&(r=new IntersectionObserver((([e])=>(s=e.isIntersecting)&&(n=null,o()))),r.observe(i),e.then((()=>(r.disconnect(),r=null,a())))),function(e){return s?Promise.resolve(e):r?(n||(n=new Promise(((e,t)=>(o=e,a=t)))),n.then((()=>e))):Promise.reject()}}function Ur(e){e._invalidate(),e._invalidate=hr,e._pending();const t=e._value,n=++e._version;let r=null;const i=e._promise=(e._inputs.length?Promise.all(e._inputs.map(Lr)).then((function(i){if(e._version!==n)throw Er;for(let t=0,n=i.length;t<n;++t)switch(i[t]){case Sr:i[t]=r=qr(e);break;case Nr:r||(r=qr(e)),i[t]=Ir(r,e);break;case xr:i[t]=e}return e._definition.apply(t,i)})):new Promise((n=>n(e._definition.call(t))))).then((function(t){if(e._version!==n)throw Er;if(function(e){return e&&"function"==typeof e.next&&"function"==typeof e.return}(t))return(r||qr(e)).then((i=t,function(){i.return()})),function(e,t,n){const r=e._module._runtime;let i;function s(e){return new Promise((e=>e(n.next(i)))).then((({done:t,value:n})=>t?void 0:Promise.resolve(n).then(e)))}function o(){const n=s((s=>{if(e._version!==t)throw Er;return i=s,a(s,n).then((()=>r._precompute(o))),e._fulfilled(s),s}));n.catch((r=>{r!==Er&&e._version===t&&(a(void 0,n),e._rejected(r))}))}function a(t,n){return e._value=t,e._promise=n,e._outputs.forEach(r._updates.add,r._updates),r._compute()}return s((n=>{if(e._version!==t)throw Er;return i=n,r._precompute(o),n}))}(e,n,t);var i;return t}));i.then((t=>{e._value=t,e._fulfilled(t)}),(t=>{t!==Er&&(e._value=void 0,e._rejected(t))}))}function Dr(e,t){e._invalidate(),e._invalidate=hr,e._pending(),++e._version,e._indegree=NaN,(e._promise=Promise.reject(t)).catch(hr),e._value=void 0,e._rejected(t)}function Br(e){return globalThis[e]}Object.defineProperties(Or.prototype,{_precompute:{value:function(e){this._precomputes.push(e),this._compute()},writable:!0,configurable:!0},_compute:{value:function(){return this._computing||(this._computing=this._computeSoon())},writable:!0,configurable:!0},_computeSoon:{value:function(){return new Promise(Cr).then((()=>this._disposed?void 0:this._computeNow()))},writable:!0,configurable:!0},_computeNow:{value:async function(){let e,t,n=[],r=this._precomputes;if(r.length){this._precomputes=[];for(const e of r)e();await function(e=0){let t=Promise.resolve();for(let n=0;n<e;++n)t=t.then((()=>{}));return t}(3)}e=new Set(this._dirty),e.forEach((function(t){t._inputs.forEach(e.add,e);const n=function(e){if(e._observer!==yr)return!0;const t=new Set(e._outputs);for(const e of t){if(e._observer!==yr)return!0;e._outputs.forEach(t.add,t)}return!1}(t);n>t._reachable?this._updates.add(t):n<t._reachable&&t._invalidate(),t._reachable=n}),this),e=new Set(this._updates),e.forEach((function(t){t._reachable?(t._indegree=0,t._outputs.forEach(e.add,e)):(t._indegree=NaN,e.delete(t))})),this._computing=null,this._updates.clear(),this._dirty.clear(),e.forEach((function(e){e._outputs.forEach(Mr)}));do{for(e.forEach((function(e){0===e._indegree&&n.push(e)}));t=n.pop();)Ur(t),t._outputs.forEach(i),e.delete(t);e.forEach((function(t){Pr(t)&&(Dr(t,new cr("circular definition")),t._outputs.forEach(Rr),e.delete(t))}))}while(e.size);function i(e){0==--e._indegree&&n.push(e)}},writable:!0,configurable:!0},dispose:{value:function(){this._computing=Promise.resolve(),this._disposed=!0,this._variables.forEach((e=>{e._invalidate(),e._version=NaN}))},writable:!0,configurable:!0},module:{value:function(e,t=hr){let n;if(void 0===e)return(n=this._init)?(this._init=null,n):new kr(this);if(n=this._modules.get(e),n)return n;this._init=n=new kr(this),this._modules.set(e,n);try{e(this,t)}finally{this._init=null}return n},writable:!0,configurable:!0},fileAttachments:{value:function(e){return Object.assign((t=>{const n=e(t+="");if(null==n)throw new Error(`File not found: ${t}`);if("object"==typeof n&&"url"in n){const{url:e,mimeType:r}=n;return new Mn(e,t,r)}return new Mn(n,t)}),{prototype:Mn.prototype})},writable:!0,configurable:!0}});const Hr=Or.prototype.fileAttachments((function(e){return e}));class Fr{constructor(){const e=Object.assign(new ar,{FileAttachment:()=>Hr});this.runtime=new Or(e),this.main=this.runtime.module()}redefine(e,t,n=[]){this.main.redefine(e,n,t)}variable(e,t,n=[],r){this.main.variable(r).define(e,n,t)}module(e,t){const n=this.runtime.module(e);return t?n.derive(t,this.main):n}import(e,t,n=t){this.main.import(t,n,e)}value(e){return this.main.value(e)}define(e,t){const n=new Map;e.forEach((e=>{if(e.module){const[t,r,i]=e.module;n.set(t,this.module(r,i))}else if(e.import){const[t,r,i]=e.import;this.import(n.get(t),r,i)}else if(e.define){const[n,r,i]=e.define;this.variable(n,i,r,t(e))}}))}handler(e){return async t=>{t.preventDefault();const[n,r]=await this.value(e),i=await Promise.all(r.map((e=>this.value(e)))),s=Object.create(null);i.forEach(((e,t)=>s[r[t]]=e)),await n(s)(t),i.forEach(((e,t)=>{const n=r[t];e!==s[n]&&this.redefine(n,s[n])}))}}}class zr extends ee{createRenderRoot(){return this}connectedCallback(){this.__initchildnodes||(this.__initchildnodes=!0,this.initialChildNodes(Array.from(this.childNodes,(e=>(e.__element=this,e)))),function(e,t=0){const n=e.childNodes;let r=n.length;for(;r>t;)e.removeChild(n[--r])}(this)),super.connectedCallback()}initialChildNodes(e){this.__children=e}articleData(){let e=this;for(;"ARTICLE"!==e.tagName;e=e.parentNode||e.__element);return e?.__data}}function Wr(e){return R`<span class="error-block">${e}</span>`}const Vr="dependencies",Gr=Symbol("dependencies"),Yr=Symbol("load"),Zr=Promise.resolve(!0),Jr=new Map;function Kr(e){let t="undefined"!=typeof HTMLElement&&e instanceof HTMLElement?e.constructor:e;for(;t&&!Object.hasOwn(t,Vr);)if(t=Object.getPrototypeOf(t),t&&"HTMLElement"===t.name)return null;return t}function Xr(e){const t=Kr(e);if(!t)return Zr;const n=t[Gr]||(t[Gr]={});if(n[Yr])return n[Yr];const r={main:[],css:[]},i=t[Vr];return i.forEach((({name:t,version:n,main:i,css:s})=>{const o=function(e,t){return n=>`https://cdn.jsdelivr.net/npm/${e}@${t}/${n}`}(t,n),a=o(i),l=o(s),c=Jr.get(a)||ht(a);Jr.set(a,c),r.main.push(c),s&&!Jr.has(l)&&(Jr.set(l,!0),r.css.push(function(e,t=globalThis.document){return new Promise((function(n,r){const i=t.createElement("link");i.rel="stylesheet",i.href=e,i.onerror=r,i.onload=n,t.head.appendChild(i)}))}(l,e.ownerDocument)))})),n[Yr]=Promise.all(r.main.concat(r.css)).then((e=>{const n=i.reduce(((t,n,r)=>(t[n.name]=e[r],t)),{});!function(e,t){const n=Kr(e);if(n){const e=n[Gr]||(n[Gr]={});for(const n in t)e[n]=t[n];e[Yr]=Zr}}(t,n)}))}class Qr extends zr{getDependency(e){return function(e,t){return Kr(e)?.[Gr]?.[t]}(this,e)}shouldUpdate(){return!!function(e){const t=Kr(e);return!t||t[Gr]?.[Yr]===Zr}(this)||(Xr(this).then((()=>{this.requestUpdate()})),!1)}}const ei=[[1,0],[2,0],[3,0],[3,2],[4,0],[5,0],[6,0],[7,0],[8,0],[9,0],[11,10],[11,3],[11,2],[11,0],[12,11],[13,11],[14,11],[15,11],[17,16],[18,16],[18,17],[19,16],[19,17],[19,18],[20,16],[20,17],[20,18],[20,19],[21,16],[21,17],[21,18],[21,19],[21,20],[22,16],[22,17],[22,18],[22,19],[22,20],[22,21],[23,16],[23,17],[23,18],[23,19],[23,20],[23,21],[23,22],[23,12],[23,11],[24,23],[24,11],[25,24],[25,23],[25,11],[26,24],[26,11],[26,16],[26,25],[27,11],[27,23],[27,25],[27,24],[27,26],[28,11],[28,27],[29,23],[29,27],[29,11],[30,23],[31,30],[31,11],[31,23],[31,27],[32,11],[33,11],[33,27],[34,11],[34,29],[35,11],[35,34],[35,29],[36,34],[36,35],[36,11],[36,29],[37,34],[37,35],[37,36],[37,11],[37,29],[38,34],[38,35],[38,36],[38,37],[38,11],[38,29],[39,25],[40,25],[41,24],[41,25],[42,41],[42,25],[42,24],[43,11],[43,26],[43,27],[44,28],[44,11],[45,28],[47,46],[48,47],[48,25],[48,27],[48,11],[49,26],[49,11],[50,49],[50,24],[51,49],[51,26],[51,11],[52,51],[52,39],[53,51],[54,51],[54,49],[54,26],[55,51],[55,49],[55,39],[55,54],[55,26],[55,11],[55,16],[55,25],[55,41],[55,48],[56,49],[56,55],[57,55],[57,41],[57,48],[58,55],[58,48],[58,27],[58,57],[58,11],[59,58],[59,55],[59,48],[59,57],[60,48],[60,58],[60,59],[61,48],[61,58],[61,60],[61,59],[61,57],[61,55],[62,55],[62,58],[62,59],[62,48],[62,57],[62,41],[62,61],[62,60],[63,59],[63,48],[63,62],[63,57],[63,58],[63,61],[63,60],[63,55],[64,55],[64,62],[64,48],[64,63],[64,58],[64,61],[64,60],[64,59],[64,57],[64,11],[65,63],[65,64],[65,48],[65,62],[65,58],[65,61],[65,60],[65,59],[65,57],[65,55],[66,64],[66,58],[66,59],[66,62],[66,65],[66,48],[66,63],[66,61],[66,60],[67,57],[68,25],[68,11],[68,24],[68,27],[68,48],[68,41],[69,25],[69,68],[69,11],[69,24],[69,27],[69,48],[69,41],[70,25],[70,69],[70,68],[70,11],[70,24],[70,27],[70,41],[70,58],[71,27],[71,69],[71,68],[71,70],[71,11],[71,48],[71,41],[71,25],[72,26],[72,27],[72,11],[73,48],[74,48],[74,73],[75,69],[75,68],[75,25],[75,48],[75,41],[75,70],[75,71],[76,64],[76,65],[76,66],[76,63],[76,62],[76,48],[76,58]];function ti(){return{nodes:Array.from({length:77}).map((e=>({index:e}))),links:ei.map((e=>({source:e[0],target:e[1]})))}}function ni(e){return{x:e[0],y:e[1]}}function ri(e,t,n){const r="#d5aaaa",i="firebrick",s=ti(),{nodes:o,links:a}=s,l=e.select(t).attr("class","quadtree").append("svg").attr("width",n.width).attr("height",n.height).attr("viewBox","0 0 514 514"),c=l.append("g"),u=c.append("g"),d=c.append("g"),f=c.append("g"),h=c.append("g"),p=c.append("g"),m=c.append("g"),v=n.radius||4,y=[[1,1],[513,513]],b={x:321,y:321},w=e.forceManyBody(),_=e.forceLink(),g=e.forceCenter().x(257).y(257),E=e.forceSimulation().force("link",_).force("charge",w).force("center",g);let A,$,x,S=Math.sqrt(n.theta)||0,N=null,k=0,T=!0,j=!1,C=b,O=!1;function P(){return A=u.selectAll("line").data(a).enter().append("line").style("stroke","#ccc").style("stroke-width",1).style("stroke-opacity",1).style("pointer-events","none"),$=p.selectAll("circle").data(o).enter().append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",v).style("fill","#666").style("fill-opacity",1).style("cursor","pointer"),E.nodes(o).on("tick",L),E.force("link").links(a),M(),k=0,d.selectAll("rect").style("opacity",0),$.style("fill-opacity",1),l.on("mousemove",D).on("mousedown",H),$.call(e.drag().on("start",q).on("drag",I).on("end",U)),x}function M(){k!=o.length&&R(o),N.visitAfter(F),V().clear(),$.style("fill-opacity",.25)}function R(t){N=e.quadtree().extent(y).x((e=>e.x)).y((e=>e.y)),t&&N.addAll(t),k=t?t.length:0}function L(){k>0&&(R(o),V()),A.attr("x1",(e=>e.source.x)).attr("y1",(e=>e.source.y)).attr("x2",(e=>e.target.x)).attr("y2",(e=>e.target.y)),$.attr("cx",(e=>e.x)).attr("cy",(e=>e.y))}function q(t){T&&(e.event.active||E.alphaTarget(.3).restart(),t.fx=t.x,t.fy=t.y)}function I(t){T&&(t.fx=e.event.x,t.fy=e.event.y)}function U(t){T&&(e.event.active||E.alphaTarget(0),t.fx=null,t.fy=null)}function D(){j&&O&&Y(ni(e.mouse(this)))}function B(){O=!1,window.removeEventListener("mouseup",B)}function H(){if(!j)return;O=!0,window.addEventListener("mouseup",B);let t=e.event.target;Y(t&&"circle"==t.localName?t.__data__:ni(e.mouse(this)))}function F(e,t,n,r,i){let s,o,a,l,c,u=0;if(e.length){let d=[t,n,r,i].join(",");for(a=l=c=0;c<4;++c)(s=e[c])&&(o=s.value)&&(u+=o,a+=o*s.x,l+=o*s.y,s.parent=e,s.pid=d);e.x=a/u,e.y=l/u,e.x1=t,e.y1=n,e.w=r-t,e.h=i-n}else{s=e,s.x=s.data.x,s.y=s.data.y;do{u+=1}while(s=s.next)}e.value=u}function z(e){let t=[];return N.visit((function(n,r,i,s,o){if(e.x<r||e.x>=s||e.y<i||e.y>=o)return!0;t.push({x1:r,y1:i,w:s-r,h:o-i})})),t}function W(){return f.html(""),h.html(""),m.html(""),$.style("fill-opacity",1),x}function V(){let e=[];function t(n,r,i){Array.isArray(n)&&function(n,r,i){let s=r[0],o=r[1],a=[s[0]+o[0]>>1,s[1]+o[1]>>1],l=[[s,a],[[a[0],s[1]],[o[0],a[1]]],[[s[0],a[1]],[a[0],o[1]]],[a,o]];for(let r=0;r<4;++r)e.push(l[r]),l[r].depth=i,n[r]&&t(n[r],l[r],i+1)}(n,r,i)}return N.root()&&(e.push(N.extent().slice()),t(N.root(),N.extent(),1)),d.html("").selectAll("rect").data(e).enter().append("rect").attr("x",(e=>e[0][0]+.5)).attr("y",(e=>e[0][1]+.5)).attr("width",(e=>e[1][0]-e[0][0])).attr("height",(e=>e[1][1]-e[0][1])).style("fill","none").style("stroke","#ddd").style("line-width",.5),x}function G(){W();let e=C;if(!e)return;let t=[],n=[],s=0,o=0;return N.visit(((r,i,a,l,c)=>{if(!r.value)return!0;let u=r.x-e.x,d=r.y-e.y,f=l-i,h=u*u+d*d;if(r.length&&f*f/S<h){const e={x:r.x,y:r.y,v:r.value,s:5e3*r.value/h};return t.push(e),n.push({x:i,y:a,w:f,h:c-a}),s+=u*r.value/h,o+=d*r.value/h,!0}if(!r.length&&h)do{r.data!==e&&(t.push({x:r.data.x,y:r.data.y,v:1,s:5e3/h}),s+=u/h,o+=d/h)}while(r=r.next)})),f.selectAll("rect").data(n).enter().append("rect").attr("x",(e=>e.x)).attr("y",(e=>e.y)).attr("width",(e=>e.w)).attr("height",(e=>e.h)).style("pointer-events","none").style("fill","none").style("stroke",r).style("stroke-width",2),h.selectAll("path").data(t).enter().append("path").style("pointer-events","none").style("stroke","#991151").style("stroke-opacity",.3).style("stroke-dasharray",[5,5]).style("stroke-linecap","round").style("stroke-width",(e=>Math.max(1,Math.min(5,e.s||1)))).attr("d",(t=>"M"+t.x+","+t.y+"L"+e.x+","+e.y)),m.selectAll("circle").data(t).enter().append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",(e=>v*(Math.sqrt(e.v)||1))).style("pointer-events","none").style("fill",i),$.style("fill-opacity",.25),m.append("circle").attr("cx",e.x).attr("cy",e.y).attr("r",v).style("pointer-events","none").style("fill","white").style("stroke-width",1.5).style("stroke-linecap","round").style("stroke","#800080"),s=e.x-90*s,o=e.y-90*o,m.append("path").attr("d","M"+e.x+","+e.y+"L"+s+","+o).style("pointer-events","none").style("fill","none").style("stroke-width",1.5).style("stroke-linecap","round").style("stroke","purple"),x}function Y(e){return C=e,G()}return x={svg:l,quad:N,init:P,size:function(t){let n=500;if(R(),t<1)return k=0,V(),f.html(""),m.html(""),void $.style("fill-opacity",.25);k=t;let s=o[--t];N.addAll(o.slice(0,t));let a=z(s);N.add(s).visitAfter(F);let l=z(s).slice(a.length);l.length&&f.html("").selectAll("rect.foo").data(l).enter().append("rect").attr("x",(e=>e.x1)).attr("y",(e=>e.y1)).attr("width",(e=>e.w)).attr("height",(e=>e.h)).style("pointer-events","none").style("fill","none").style("stroke",r).style("stroke-width",2).style("stroke-opacity",1).transition().delay(250).duration(n).style("stroke-opacity",0).remove(),V(),$.style("fill-opacity",(e=>e.index<=t?1:.25)),m.html("").append("circle").datum(s).attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",0).style("pointer-events","none").style("fill",i).style("fill-opacity",1).transition().duration(n).ease(e.easeBackOut.overshoot(2)).attr("r",(e=>v)).transition().delay(n).duration(n).style("fill-opacity",0).remove()},clear:W,theta:function(e){return S=e*e,G()},charge:function(e){const t=+e;t==t&&w.strength(t),T&&E.alpha(.5).alphaTarget(0).restart()},layout:function(e){T!==e&&(T=e,T?E.alpha(.5).alphaTarget(0).restart():E.stop(),$.transition(500).style("fill-opacity",T?1:.25),A.transition(500).style("stroke-opacity",+T))},estimate:function(e){j!==e&&(j=e,j?(M(),Y(C)):(C=b,V().clear()))},accumulate:function(t){if(!t)return;let n=400,s=[],o=[],a={};M(),N.visitAfter((function(e){e.length&&s.push(e)})),s.forEach((function(e){const t=e.w;let n=a[t];n||o.push(a[t]=n=[]),n.push(e)})),o.sort(((e,t)=>e[0].w-t[0].w)),setTimeout((()=>{o.forEach((function(t,s){setTimeout((()=>function(t){if(t<1)return void m.html("");o[t-=1].forEach((function(t){const s=t.filter((e=>e));f.append("rect").datum(t).attr("x",(e=>e.x1)).attr("y",(e=>e.y1)).attr("width",(e=>e.w)).attr("height",(e=>e.h)).style("pointer-events","none").style("fill","none").style("stroke",r).style("stroke-width",2).style("stroke-opacity",1).transition().duration(800).delay(1200).style("stroke-opacity",0).remove(),m.selectAll("circle.foo").data(s).enter().append("circle").attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",(e=>v*(Math.sqrt(e.value)||1))).style("pointer-events","none").style("fill",i).transition().delay(n).duration(n).ease(e.easeCubicIn).attr("cx",t.x).attr("cy",t.y).remove(),m.append("circle").datum(t).attr("cx",(e=>e.x)).attr("cy",(e=>e.y)).attr("r",0).style("pointer-events","none").style("fill",i).transition().delay(720).duration(n).ease(e.easeBackOut).attr("r",(e=>v*(Math.sqrt(e.value)||1))).transition().delay(n).duration(n).style("fill","#666").style("fill-opacity",.25)}))}(s+1)),1520*s)})),setTimeout((()=>{m.selectAll("circle").transition().duration(500).style("fill-opacity",0).remove()}),1520*(1+o.length))}),1e3)}},P()}var ii=[{nodes:500,theta:0,time:.56,error:0},{nodes:500,theta:.5,time:3.72,error:.05200202597209933},{nodes:500,theta:1,time:1.62,error:.05235635117626017},{nodes:500,theta:1.5,time:.9,error:.05364959811502322},{nodes:1e3,theta:0,time:1.54,error:0},{nodes:1e3,theta:.5,time:6.42,error:.051100704681022374},{nodes:1e3,theta:1,time:2.68,error:.05145824401863238},{nodes:1e3,theta:1.5,time:1.58,error:.0527730904049427},{nodes:1500,theta:0,time:3.66,error:0},{nodes:1500,theta:.5,time:11.3,error:.05065250167285926},{nodes:1500,theta:1,time:4.36,error:.05100210193824075},{nodes:1500,theta:1.5,time:2.64,error:.052263724165450914},{nodes:2e3,theta:0,time:6.32,error:0},{nodes:2e3,theta:.5,time:16.84,error:.05040655452845216},{nodes:2e3,theta:1,time:6.32,error:.050773438684784816},{nodes:2e3,theta:1.5,time:3.76,error:.05208289581090376},{nodes:2500,theta:0,time:10,error:0},{nodes:2500,theta:.5,time:22.48,error:.05018702377740935},{nodes:2500,theta:1,time:8.04,error:.05054754976730526},{nodes:2500,theta:1.5,time:5.02,error:.05183226903289724},{nodes:3e3,theta:0,time:14.74,error:0},{nodes:3e3,theta:.5,time:27.68,error:.050308818616019844},{nodes:3e3,theta:1,time:10.06,error:.05067487078391384},{nodes:3e3,theta:1.5,time:6.22,error:.05199211876791672},{nodes:3500,theta:0,time:20.64,error:0},{nodes:3500,theta:.5,time:33.62,error:.05004853487486027},{nodes:3500,theta:1,time:12.2,error:.05041703116269491},{nodes:3500,theta:1.5,time:7.7,error:.05170552704388485},{nodes:4e3,theta:0,time:27.32,error:0},{nodes:4e3,theta:.5,time:38.88,error:.05019060517654669},{nodes:4e3,theta:1,time:14.58,error:.05056004954031823},{nodes:4e3,theta:1.5,time:8.9,error:.051869004205317155},{nodes:4500,theta:0,time:34.54,error:0},{nodes:4500,theta:.5,time:44.4,error:.050120388342931955},{nodes:4500,theta:1,time:16.88,error:.0504893948312208},{nodes:4500,theta:1.5,time:10.38,error:.05178804015573142},{nodes:5e3,theta:0,time:43.5,error:0},{nodes:5e3,theta:.5,time:49.82,error:.0502078881851173},{nodes:5e3,theta:1,time:19.42,error:.050556513572848315},{nodes:5e3,theta:1.5,time:12.36,error:.05182141623831191},{nodes:5500,theta:0,time:52.86,error:0},{nodes:5500,theta:.5,time:56.04,error:.05000671534740984},{nodes:5500,theta:1,time:21.84,error:.05036747490974292},{nodes:5500,theta:1.5,time:13.16,error:.051636964809069846},{nodes:6e3,theta:0,time:63.12,error:0},{nodes:6e3,theta:.5,time:62.34,error:.050108840001680185},{nodes:6e3,theta:1,time:25.44,error:.0504845789284521},{nodes:6e3,theta:1.5,time:15.1,error:.05178990719815004},{nodes:6500,theta:0,time:74.02,error:0},{nodes:6500,theta:.5,time:68.32,error:.05015978570893315},{nodes:6500,theta:1,time:27.22,error:.050524547776730995},{nodes:6500,theta:1.5,time:16.58,error:.051807786978559624},{nodes:7e3,theta:0,time:86.86,error:0},{nodes:7e3,theta:.5,time:75.84,error:.05009715454588301},{nodes:7e3,theta:1,time:28.96,error:.050464252838042886},{nodes:7e3,theta:1.5,time:18.34,error:.05175272301004472},{nodes:7500,theta:0,time:97.92,error:0},{nodes:7500,theta:.5,time:80.12,error:.050103625186719125},{nodes:7500,theta:1,time:31.7,error:.05046902952584346},{nodes:7500,theta:1.5,time:20.72,error:.051759162426569125},{nodes:8e3,theta:0,time:114.32,error:0},{nodes:8e3,theta:.5,time:88.52,error:.05010771874184223},{nodes:8e3,theta:1,time:34.52,error:.05046208406423784},{nodes:8e3,theta:1.5,time:22.96,error:.051739305168694634},{nodes:8500,theta:0,time:129.82,error:0},{nodes:8500,theta:.5,time:97.96,error:.04991075721026138},{nodes:8500,theta:1,time:35.4,error:.050271992053986664},{nodes:8500,theta:1.5,time:24.1,error:.051558114104811856},{nodes:9e3,theta:0,time:148.58,error:0},{nodes:9e3,theta:.5,time:105.14,error:.049955850454765756},{nodes:9e3,theta:1,time:38.02,error:.050320401669984936},{nodes:9e3,theta:1.5,time:25.9,error:.051606533672847184},{nodes:9500,theta:0,time:163.66,error:0},{nodes:9500,theta:.5,time:110.06,error:.050049450254373},{nodes:9500,theta:1,time:40.44,error:.05040925481053241},{nodes:9500,theta:1.5,time:27.48,error:.0516827503789717},{nodes:1e4,theta:0,time:181.56,error:0},{nodes:1e4,theta:.5,time:112.24,error:.050078126512543175},{nodes:1e4,theta:1,time:43.94,error:.05043578694613407},{nodes:1e4,theta:1.5,time:30.7,error:.05171306545026989}];class si extends Qr{static get dependencies(){return[{name:"vega",version:"5",main:"build/vega.min.js"}]}static get properties(){return{value:{type:Number}}}constructor(e){super(),this._spec=e,this.value=1}render(){const e=this.getDependency("vega");if(e)return this._root||(this._root=document.createElement("div"),this._root.style["margin-left"]="-35px",this._root.style.padding="1em 0",this._view=new e.View(e.parse(this._spec)).renderer("svg").logLevel(e.Warn).initialize(this._root).insert("perf",ii),this._view.addSignalListener("theta",((e,t)=>{t!=this.value&&(this.value=t,this.dispatchEvent(new Event("input")))}))),this._view.signal("theta",this.value).run(),this._root}}const oi={width:635,height:200,autosize:"fit",config:{title:{fontSize:12,frame:"group",anchor:"start",offset:0}},signals:[{name:"theta",value:-1,on:[{events:"text:mouseover, line:mouseover",update:"datum.theta"},{events:"text:mouseout, line:mouseout",update:"-abs(theta) - 1"}]},{name:"foci",value:[0,.5,1,1.5]}],data:[{name:"perf",transform:[{type:"filter",expr:"datum.theta > 0"}]},{name:"labels",source:"perf",transform:[{type:"filter",expr:"datum.nodes === 1e4"},{type:"formula",as:"label",expr:'datum.theta ? "ϴ = " + datum.theta : "Naïve"'}]}],scales:[{name:"xs",type:"linear",domain:{data:"perf",field:"nodes"},range:"width"},{name:"ys",type:"linear",domain:{data:"perf",field:"error"},range:"height",zero:!1,nice:!0},{name:"cs",type:"ordinal",range:["rgb(140, 41, 129)","rgb(222, 73, 104)","rgb(254, 159, 109)"]}],title:"Average Error, Relative to Naïve Calculation (pixels)",axes:[{orient:"left",scale:"ys",grid:!0,tickCount:5,minExtent:35},{orient:"bottom",scale:"xs",title:"Number of Points"}],marks:[{type:"group",from:{facet:{data:"perf",name:"series",groupby:"theta"}},marks:[{type:"line",from:{data:"series"},encode:{enter:{interpolate:"monotone",x:{scale:"xs",field:"nodes"},y:{scale:"ys",field:"error"},stroke:{scale:"cs",field:"theta"},strokeWidth:{value:3}},update:{opacity:{signal:"indexof(foci, theta) < 0 || theta === datum.theta ? 1 : 0.25"}}}}]},{type:"text",from:{data:"labels"},encode:{enter:{x:{scale:"xs",field:"nodes"},dx:{value:6},y:{scale:"ys",field:"error"},baseline:{value:"middle"},text:{field:"label"},fill:{scale:"cs",field:"theta"}},update:{opacity:{signal:"indexof(foci, theta) < 0 || theta === datum.theta ? 1 : 0.25"}}}}]};const ai={width:635,height:200,autosize:"fit",config:{title:{fontSize:12,frame:"group",anchor:"start",offset:0}},signals:[{name:"theta",value:-1,on:[{events:"text:mouseover, line:mouseover",update:"datum.theta"},{events:"text:mouseout, line:mouseout",update:"-abs(theta) - 1"}]},{name:"foci",value:[0,.5,1,1.5]}],data:[{name:"perf"},{name:"labels",source:"perf",transform:[{type:"filter",expr:"datum.nodes === 1e4"},{type:"formula",as:"label",expr:'datum.theta ? "ϴ = " + datum.theta : "Naïve"'}]}],scales:[{name:"xs",type:"linear",domain:{data:"perf",field:"nodes"},range:"width"},{name:"ys",type:"linear",domain:{data:"perf",field:"time"},range:"height",nice:!0},{name:"cs",type:"ordinal",domain:{data:"perf",field:"theta",sort:!0},range:["rgb(59, 15, 112)","rgb(140, 41, 129)","rgb(222, 73, 104)","rgb(254, 159, 109)"]}],title:"Average Running Time (milliseconds)",axes:[{orient:"left",scale:"ys",grid:!0,tickCount:5,minExtent:35},{orient:"bottom",scale:"xs",title:"Number of Points"}],marks:[{type:"group",from:{facet:{data:"perf",name:"series",groupby:"theta"}},marks:[{type:"line",from:{data:"series"},encode:{enter:{interpolate:"monotone",x:{scale:"xs",field:"nodes"},y:{scale:"ys",field:"time"},stroke:{scale:"cs",field:"theta"},strokeWidth:{value:3}},update:{opacity:{signal:"indexof(foci, theta) < 0 || theta === datum.theta ? 1 : 0.25"}}}}]},{type:"text",from:{data:"labels"},encode:{enter:{x:{scale:"xs",field:"nodes"},dx:{value:6},y:{scale:"ys",field:"time"},baseline:{value:"middle"},text:{field:"label"},fill:{scale:"cs",field:"theta"}},update:{opacity:{signal:"indexof(foci, theta) < 0 || theta === datum.theta ? 1 : 0.25"}}}}]};var li=Object.freeze({__proto__:null,attrs:function(){return[{define:[null,["step"],function(e){return e}],cell:0},{define:[null,["theta"],function(e){return e}],cell:1},{define:[null,["charge"],function(e){return e}],cell:2},{define:[null,["layout","estimate"],function(e,t){return e&&!t}],cell:3},{define:[null,["estimate"],function(e){return e}],cell:4},{define:[null,["accum"],function(e){return e}],cell:5}]},cells:function(){return[{define:["charge",[],function(){return-30}],cell:0},{define:["step",[],function(){return 0}],cell:1},{define:["accum",[],function(){return 0}],cell:2},{define:["theta",[],function(){return 0}],cell:3},{define:["focus",[],function(){return-1}],cell:4},{define:["layout",[],function(){return!0}],cell:5},{define:["estimate",[],function(){return!1}],cell:6},{define:[null,["Inputs"],function(e){return e.range([-30,10],{step:1,label:"Force Strength"})}],cell:7},{define:[null,["Inputs"],function(e){return e.range([0,77],{step:1,label:"Inserted Points"})}],cell:8},{define:[null,["Inputs","focus"],function(e,t){return e.range([0,2],{step:.1,label:"Theta Θ",value:t<0?-(t+1):t})}],cell:9}]},event:function(){return[{define:["__event0__",["alert"],function(e){return[t=>t=>{e("👍 🎉")},[]]}],cell:0},{define:["__event1__",[],function(){return[e=>t=>{e.layout=!1,e.step=0},["layout","step"]]}],cell:1},{define:["__event2__",[],function(){return[e=>t=>{e.layout=!1,e.step=1},["layout","step"]]}],cell:2},{define:["__event3__",[],function(){return[e=>t=>{e.layout=!1,e.step=2},["layout","step"]]}],cell:3},{define:["__event4__",[],function(){return[e=>t=>{e.layout=!1,e.step=Math.min(e.step+1,77)},["layout","step"]]}],cell:4},{define:["__event5__",[],function(){return[e=>t=>{e.layout=!1,e.step=Math.min(e.step+1,77)},["layout","step"]]}],cell:5},{define:["__event6__",[],function(){return[e=>t=>{e.layout=!1,e.step=Math.min(e.step+1,77)},["layout","step"]]}],cell:6},{define:["__event7__",[],function(){return[e=>t=>{e.layout=!1,++e.accum},["layout","accum"]]}],cell:7},{define:["__event8__",[],function(){return[e=>t=>{e.theta=0,e.estimate=!0},["theta","estimate"]]}],cell:8},{define:["__event9__",[],function(){return[e=>t=>{e.theta=1,e.estimate=!0},["theta","estimate"]]}],cell:9},{define:["__event10__",[],function(){return[e=>t=>{e.focus=0},["focus"]]}],cell:10},{define:["__event11__",[],function(){return[e=>t=>{e.focus=.5},["focus"]]}],cell:11},{define:["__event12__",[],function(){return[e=>t=>{e.focus=1},["focus"]]}],cell:12},{define:["__event13__",[],function(){return[e=>t=>{e.focus=1.5},["focus"]]}],cell:13},{define:["__event14__",[],function(){return[e=>t=>{e.focus=1},["focus"]]}],cell:14},{define:["__event15__",[],function(){return[e=>t=>{e.focus=1.5},["focus"]]}],cell:15},{define:["__event16__",[],function(){return[e=>t=>{e.focus=1.5},["focus"]]}],cell:16},{define:["__event17__",[],function(){return[e=>t=>{e.focus=1},["focus"]]}],cell:17},{define:["__event18__",[],function(){return[e=>t=>{e.focus=.5},["focus"]]}],cell:18},{define:["__event19__",[],function(){return[e=>t=>{e.step=77,e.estimate=!1,e.layout=!0},["step","estimate","layout"]]}],cell:19}]}});window.customElements.define("cell-view",class extends zr{static get properties(){return{value:{state:!0},status:{type:String,state:!0}}}constructor(){super(),this.status=ue,this.observer=new he(((e,t)=>{this.status=e,e!==ue&&(this.value=t,this.dispatchEvent(new Event("change")))}))}render(){switch(this.status){case ue:case de:return this.value;case fe:return Wr(this.value.error);default:return Wr(`Unrecognized status: ${this.status}.`)}}}),window.customElements.define("barnes-hut",class extends Qr{static get dependencies(){return[{name:"d3",version:"4",main:"build/d3.min.js"}]}static get properties(){return{width:{type:Number},height:{type:Number},size:{type:Number},theta:{type:Number},charge:{type:Number},radius:{type:Number},accumulate:{type:Number},layout:{type:Boolean,converter:e=>"false"!==e},estimate:{type:Boolean,converter:e=>"false"!==e}}}constructor(){super(),this.width=514,this.height=514,this.size=0,this.theta=0,this.charge=-30,this.radius=4,this.accumulate=!1,this.layout=!0,this.estimate=!1}willUpdate(e){this._sim&&e.forEach(((e,t)=>{this._sim[t](this[t])}))}render(){const e=this.getDependency("d3");if(e)return this._root||(this._root=document.createElement("div"),this._root.setAttribute("class","quad"),this._sim=ri(e,this._root,{width:this.width,height:this.height,theta:this.theta,radius:this.radius})),this._root}}),window.customElements.define("error-plot",class extends si{constructor(){super(oi)}}),window.customElements.define("time-plot",class extends si{constructor(){super(ai)}}),window.addEventListener("DOMContentLoaded",(()=>{const e=document.querySelector("article");pe(new Fr,e,li,{_id:21,attrs:[["1","size",0],["1","theta",1],["1","charge",2],["1","layout",3],["1","estimate",4],["1","accumulate",5]],events:[["2","click",0],["3","click",1],["4","click",2],["5","click",3],["6","click",4],["7","click",5],["8","click",6],["9","click",7],["10","click",8],["11","click",9],["12","click",10],["13","click",11],["14","click",12],["15","click",13],["16","click",14],["17","click",15],["18","click",16],["19","click",17],["20","click",18],["21","click",19]]})}));

    </script>
</html>